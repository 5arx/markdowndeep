// MarkdownDeep  http://toptensoftware.com/MarkdownDeep
// Copyright (C) 2010 Topten Software. Some Rights Reserved
// Minified by MiniME from toptensoftware.com
var MarkdownDeepEditor=new(function(){var q=false,x={Z:"undo",Y:"redo",B:"bold",I:"italic",H:"heading",K:"code",U:
"ullist",O:"ollist",Q:"indent",E:"outdent",L:"link",G:"img",R:"hr","0":"h0","1":"h1","2":"h2","3":"h3","4":"h4","5":"h5"
,"6":"h6"};function A(d,b){return d.substr(0,b.length)==b}function t(d,b){return d.substr(-b.length)==b}function u(b){
return b==" "||b=="\t"||b=="\r"||b=="\n"}function w(b){return b=="\r"||b=="\n"}function y(e){var b=0,d=e.length;while(b<
d&&u(e.charAt(b)))b++;while(d-1>b&&u(e.charAt(d-1)))d--;return e.substr(b,d-b)}function r(b,d,e){if(b.addEventListener)b
.addEventListener(d,e,false);else if(b.attachEvent)b.attachEvent("on"+d,e)}function v(b){if(b.preventDefault){b.
preventDefault();return false}if(b.cancelBubble!==undefined){b.cancelBubble=true;b.keyCode=0;return false}return false}
function z(d,b){return b-d.value.slice(0,b).split("\r\n").length+1}function p(){}a=p.prototype;a.D=function(b){this.ac=b
;if(q){var d=document.selection.createRange(),f=d.duplicate();f.moveToElementText(b);var e=-f.moveStart("character",-
10000000);this.ad=-d.moveStart("character",-10000000)-e;this.aa=-d.moveEnd("character",-10000000)-e;this.af=b.value.
replace(/\r\n/gm,"\n")}else{this.ad=b.selectionStart;this.aa=b.selectionEnd;this.af=b.value}};a.u=function(){var b=new p
();b.ac=this.ac;b.aa=this.aa;b.ad=this.ad;b.af=this.af;return b};a.m=function(){this.ac.value=this.af;this.ac.focus();
if(q){var b=this.ac.createTextRange();b.collapse(true);b.moveEnd("character",this.aa);b.moveStart("character",this.ad);b
.select()}else this.ac.setSelectionRange(this.ad,this.aa)};a.J=function(b){this.af=this.af.substr(0,this.ad)+b+this.af.
substr(this.aa);this.aa=this.ad+b.length};function s(b,d,e,f){if(b<d)return b;return b<d+e?d:b+f-e}a.I=function(b,d,e){
this.af=this.af.substr(0,b)+e+this.af.substr(b+d);this.ad=s(this.ad,b,d,e.length);this.aa=s(this.aa,b,d,e.length)};a.t=
function(){return this.af.substr(this.ad,this.aa-this.ad)};a.C=function(d,b){this.aa+=b;this.ad-=d};a.G=function(b){
return this.ad>=b.length&&this.af.substr(this.ad-b.length,b.length)==b};a.s=function(b){return this.af.substr(this.aa,b.
length)==b};a.U=function(){while(u(this.af.charAt(this.ad)))this.ad++;while(this.aa>this.ad&&u(this.af.charAt(this.aa-1)
))this.aa--};a.E=function(b){return b==0||w(this.af.charAt(b-1))};a.p=function(b){while(b>0&&!w(this.af.charAt(b-1)))b--
;return b};a.r=function(b){while(b<this.af.length&&!w(this.af.charAt(b)))b++;return b};a.w=function(b){return this.P(
this.r(b))};a.T=function(b){while(b<this.af.length&&u(this.af.charAt(b)))b++;return b};a.P=function(b){if(this.af.substr
(b,2)=="\r\n")return b+2;if(w(this.af.charAt(b)))return b+1;return b};a.R=function(b){if(b>2&&this.af.substr(b-2,2)==
"\r\n")return b-2;if(b>1&&w(this.af.charAt(b-1)))return b-1;return b};a.M=function(){this.ad=this.p(this.ad);if(!this.E(
this.aa))this.aa=this.P(this.r(this.aa))};a.S=function(b){while(b>0&&u(this.af.charAt(b-1)))b--;return b};a.Q=function(b
){while(u(this.af.charAt(b)))b++;return b};a.L=function(){this.ad=this.S(this.ad);this.aa=this.Q(this.aa)};a.o=function(
){var d=this.t(),b=d.match(/\n[ \t\r]*\n/);if(b){alert("Please make a selection that doesn't include a paragraph break")
;return false}return true};a.B=function(f){var e=this.af.length;for(var b=f;b<e;b++){var d=this.af[b];if(w(d))
return true;if(!u(this.af.charAt(b)))return false}return true};a.y=function(b){var e=b;b=this.p(b);if(this.B(b))return b
;while(b>0){var d=this.p(this.R(b));if(d==0)break;if(this.B(d))break;b=d}if(this.q(b).ah!=0){b=this.p(e);while(b>0){if(
this.q(b).ah!=0)return b;b=this.p(this.R(b))}}return b};a.v=function(b){while(b<this.af.length){if(this.B(b))break;b=
this.w(b)}return b};a.K=function(){this.ad=this.y(this.ad);this.aa=this.v(this.ad)};a.q=function(d){var e=this.af.substr
(d,10),b=e.match(/^\s{0,3}(\*|\d+\.)(?:\ |\t)*/);if(!b)return{ab:"",ah:0};if(b[1]=="*")return{ab:"*",ah:b[0].length};
else return{ab:"1",ah:b[0].length}};function l(b,e,f){if(!b.setSelectionRange)q=true;this.Y=null;this.ai=[];this.ag=0;
this.ae=3;this.Z=new MarkdownDeep.Markdown();this.Z.SafeMode=false;this.Z.ExtraMode=true;this.ac=b;this.W=e;this.X=f;var
 g=this;r(b,"keyup",function(){g.H()});r(b,"keydown",function(d){return g.F(d)});r(b,"paste",function(){g.H()});r(b,
"input",function(){g.H()});r(b,"mousedown",function(){g.O(3)});this.H()}var a=l.prototype,c=l.prototype;a.F=function(b){
var d=null,f=true;if(b.ctrlKey||b.metaKey){var e=String.fromCharCode(b.charCode||b.keyCode);if(!this.disableShortCutKeys
&&x[e]!=undefined){this.InvokeCommand(x[e]);return v(b)}switch(e){case"V":d=1;break;case"X":d=2;break}}else switch(b.
keyCode){case 9:if(!this.disableTabHandling){this.InvokeCommand(b.shiftKey?"untab":"tab");return v(b)}else d=1;break;
case 37:case 39:case 38:case 40:case 36:case 35:case 33:case 34:d=3;break;case 8:case 46:d=2;break;case 13:d=4;break;
default:d=1}if(d!=null)this.O(d);if(!this.disableAutoIndent)if(b.keyCode==13&&(!q||b.ctrlKey)){this.InvokeCommand(
"indented_newline");this.ai.pop();this.ag--;return v(b)}};a.O=function(b){if(this.ae==b)return;this.ae=b;this.n()};a.n=
function(){var b=new p();b.D(this.ac);this.ai.splice(this.ag,this.ai.length-this.ag,b);this.ag=this.ai.length};a.H=
function(e){var b=this.ac.value;if(b===this.Y&&this.Y!==null)return;if(this.onPreTransform)this.onPreTransform(this,b);
var d=this.Z.Transform(b);if(this.onPostTransform)this.onPostTransform(this,d);if(this.W)this.W.innerHTML=d;if(this.X){
this.X.innerHTML="";this.X.appendChild(document.createTextNode(d))}if(this.onPostUpdateDom)this.onPostUpdateDom(this);
this.Y=b};c.onOptionsChanged=function(){this.Y=null;this.H()};c.cmd_undo=function(){if(this.ag>0){if(this.ag==this.ai.
length){this.n();this.ag--}this.ag--;this.ai[this.ag].m();this.ae=0;this.H()}};c.cmd_redo=function(){if(this.ag+1<this.
ai.length){this.ag++;this.ai[this.ag].m();this.ae=0;this.H();if(this.ag==this.ai.length-1)this.ai.pop()}};a.N=function(d
,f){d.K();d.L();var b=d.t();b=y(b);var g=0,e=b.match(/^(\#+)(.*?)(\#+)?$/);if(e){b=y(e[2]);g=e[1].length}else{e=b.match(
/^(.*?)(?:\r\n|\n|\r)\s*(\-*|\=*)$/);if(e){b=y(e[1]);g=e[2].charAt(0)=="="?1:0}else{b=b.replace(/(\r\n|\n|\r)/gm,"");g=0
}}if(f==-1)f=(g+1)%4;var h=0,j=0;if(f==0){if(b=="Heading"){d.J("");return true}j=b.length;h=0}else{if(b=="")b="Heading";
h=f+1;j=b.length;var i="";for(var k=0;k<f;k++)i+="#";b=i+" "+b+" "+i}b+="\n\n";if(d.ad!=0){b="\n\n"+b;h+=2}d.J(b);d.ad+=
h;d.aa=d.ad+j;return true};c.cmd_heading=function(b){return this.N(b,-1)};c.cmd_h0=function(b){return this.N(b,0)};c.
cmd_h1=function(b){return this.N(b,1)};c.cmd_h2=function(b){return this.N(b,2)};c.cmd_h3=function(b){return this.N(b,3)}
;c.cmd_h4=function(b){return this.N(b,4)};c.cmd_h5=function(b){return this.N(b,5)};c.cmd_h6=function(b){return this.N(b,
6)};a.x=function(j,h){j.M();var d=j.t().split("\n");for(var b=0;b<d.length;b++)if(d[b].charAt(0)=="\t"){var f="",e=0;
while(d[b].charAt(e)=="\t"){f+="    ";e++}var i=f+d[b].substr(e);d.splice(b,1,i)}if(h===null){var b;for(b=0;b<d.length;
b++){if(y(d[b])=="")continue;if(d[b].charAt(0)=="\t"){var f="",e=0;while(d[b].charAt(e)=="\t"){f+="    ";e++}var i=f+d[b
].substr(b);d.splice(b,1,i)}if(!A(d[b],"    "))break}h=b!=d.length}for(var b=0;b<d.length;b++){if(y(d[b])=="")continue;
var g=d[b];if(h)g="    "+d[b];else if(A(d[b],"\t"))g=d[b].substr(1);else if(A(d[b],"    "))g=d[b].substr(4);d.splice(b,1
,g)}j.J(d.join("\n"))};c.cmd_code=function(b){if(b.ad==b.aa){var d=b.p(b.ad);if(b.B(d)){b.L();b.J("\n\n    Code\n\n");b.
ad+=6;b.aa=b.ad+4;return true}}if(b.t().indexOf("\n")<0){b.U();if(b.G("`"))b.ad--;if(b.s("`"))b.aa++;return this.k(b,"`"
)}this.x(b,null);return true};c.cmd_tab=function(b){if(b.t().indexOf("\n")>0)this.x(b,true);else{var e=b.p(b.ad),d;for(d
=e;d<b.ad;d++)if(b.af.charAt(d)!=" ")break;if(d==b.ad){var f=4-(d-e)%4;b.J("    ".substr(0,f))}else b.J("\t");b.ad=b.aa}
return true};c.cmd_untab=function(b){if(b.t().indexOf("\n")>0){this.x(b,false);return true}return false};a.k=function(d,
e){var g=d.af,f=e.length,b=d.t();if(A(b,e)&&t(b,e))d.J(b.substr(f,b.length-f*2));else{d.U();b=d.t();if(!b)b="text";else 
b=b.replace(/(\r\n|\n|\r)/gm,"");d.J(e+b+e);d.C(-f,-f)}return true};c.cmd_bold=function(b){if(!b.o())return false;b.U();
if(b.G("**"))b.ad-=2;if(b.s("**"))b.aa+=2;return this.k(b,"**")};c.cmd_italic=function(b){if(!b.o())return false;b.U();
if(b.G("*")&&!b.G("**")||b.G("***"))b.ad-=1;if(b.s("*")&&!b.G("**")||b.s("***"))b.aa+=1;return this.k(b,"*")};a.A=
function(b,g){if(false&&b.ad==b.aa){b.L();b.J("\n\n> Quote\n\n");b.ad+=4;b.aa=b.ad+5;return true}b.M();var e=b.t().split
("\n");for(var d=0;d<e.length-1;d++){var f=e[d];if(g){if(A(e[d],"> "))f=e[d].substr(2)}else f="> "+e[d];e.splice(d,1,f)}
b.J(e.join("\n"));return true};c.cmd_indent=function(b){return this.A(b,false)};c.cmd_outdent=function(b){return this.A(
b,true)};a.z=function(b,o){var g=[];if(b.t().indexOf("\n")>0){b.M();var f=b.ad;g.push(f);while(true){f=b.w(f);if(f>=b.aa
)break;g.push(f)}}else g.push(b.p(b.ad));var n=o=="*"?"* ":"1. ";for(var d=0;d<g.length;d++){var h=b.q(g[d]);if(h.ab==o)
{n="";break}}for(var d=g.length-1;d>=0;d--){var f=g[d],h=b.q(f);b.I(f,h.ah,n)}var j=new MarkdownDeep.Markdown();j.
ExtraMode=true;var e=j.GetListItems(b.af,b.ad);while(e!=null){var i=0;for(var d=0;d<e.length-1;d++){var h=b.q(e[d]+i);
if(h.ab!="1")break;var m=(d+1).toString()+". ";b.I(e[d]+i,h.ah,m);i+=m.length-h.ah}var k=j.GetListItems(b.af,e[e.length-
1]+i);if(k!=null&&k[0]!=e[0])e=k;else e=null}if(g.length>1)b.M();return true};c.cmd_ullist=function(b){return this.z(b,
"*")};c.cmd_ollist=function(b){return this.z(b,"1")};c.cmd_link=function(b){b.U();if(!b.o())return false;var e=prompt(
"Enter the target URL:");if(e===null)return false;var d=b.t();if(d.length==0)d="link text";var f="["+d+"]("+e+")";b.J(f)
;b.ad++;b.aa=b.ad+d.length;return true};c.cmd_img=function(b){b.U();if(!b.o())return false;var e=prompt(
"Enter the image URL");if(e===null)return false;var d=b.t();if(d.length==0)d="Image Text";var f="!["+d+"]("+e+")";b.J(f)
;b.ad+=2;b.aa=b.ad+d.length;return true};c.cmd_hr=function(b){b.L();if(b.ad==0)b.J("----------\n\n");else b.J(
"\n\n----------\n\n");b.ad=b.aa;return true};c.cmd_indented_newline=function(b){b.J("\n");b.ad=b.aa;var e=b.p(b.R(b.ad))
,d=e;while(true){var f=b.af.charAt(d);if(f!=" "&&f!="\t")break;d++}if(d>e){b.J(b.af.substr(e,d-e));b.ad=b.aa}return true
};c.InvokeCommand=function(b){if(b=="undo"||b=="redo"){this["cmd_"+b]();this.ac.focus();return}var d=new p();d.D(this.ac
);var e=d.u();if(this["cmd_"+b](d)){this.ae=0;this.ai.splice(this.ag,this.ai.length-this.ag,e);this.ag++;d.m();this.H();
return true}else{this.ac.focus();return false}};delete a;delete c;this.Editor=l})()