var MarkdownDeep=new (function(){function w(a,b){if(a.indexOf!==undefined)return a.indexOf(b);for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1}function p(){this.m_SpanFormatter=new C(this);this.m_SpareBlocks=[];this.m_StringBuilder=new q;this.m_StringBuilderFinal=new q}function D(a){return a>="0"&&a<="9"}function U(a){return a>="0"&&a<="9"||a>="a"&&a<="f"||a>="A"&&a<="F"}function M(a){return a>="a"&&a<="z"||a>="A"&&a<="Z"}function s(a){return a>="a"&&a<="z"||a>="A"&&a<="Z"||a>="0"&&a<="9"}
function n(a){return a==" "||a=="\t"||a=="\r"||a=="\n"}function x(a){return a==" "||a=="\t"}function E(a){return a=="\r"||a=="\n"}function F(a){return a=="*"||a=="_"}function G(a,b){switch(a){case "\\":case "`":case "*":case "_":case "{":case "}":case "[":case "]":case "(":case ")":case ">":case "#":case "+":case "-":case ".":case "!":return true;case ":":case "|":case "=":case "<":return b}return false}function H(a,b){if(a.charAt(b)!="&")return-1;b++;var c;if(a.charAt(b)=="#"){b++;if(a.charAt(b)==
"x"||a.charAt(b)=="X"){b++;c=U}else c=D}else c=s;if(c(a.charAt(b))){for(b++;c(a.charAt(b));)b++;if(a.charAt(b)==";"){b++;return b}}return-1}function u(a,b){var c=a.indexOf("\\");if(c<0)return a;for(var d=new q,e=0;c>=0;){if(G(a.charAt(c+1),b)){c>e&&d.Append(a.substr(e,c-e));e=c+1}c=a.indexOf("\\",c+1)}e<a.length&&d.Append(a.substr(e,a.length-e));return d.ToString()}function t(a){for(var b=0,c=a.length;b<c&&n(a.charAt(b));)b++;for(;c-1>b&&n(a.charAt(c-1));)c--;return a.substr(b,c-b)}function V(a){a=
a.toLowerCase();if(a.substr(0,7)=="http://")return true;if(a.substr(0,8)=="https://")return true;if(a.substr(0,6)=="ftp://")return true;if(a.substr(0,7)=="file://")return true;return false}function W(a){if(!a)return false;if(!M(a.charAt(0)))return false;for(var b=0;b<a.length;b++){var c=a.charAt(b);if(!(s(c)||c=="_"||c=="-"||c==":"||c=="."))return false}return true}function N(a,b,c){for(c=c-1;c>=b&&n(a.charAt(c));)c--;if(c<b||a.charAt(c)!="}")return null;var d=c;for(c--;c>=b&&a.charAt(c)!="{";)c--;
if(c<b||a.charAt(c+1)!="#")return null;var e=c+2;d=a.substr(e,d-e);if(!W(d))return null;for(;c>b&&n(a.charAt(c-1));)c--;return{id:d,end:c}}function I(a){return a.indexOf("://")>=0||a.substr(0,7)=="mailto:"}function q(){this.m_content=[]}function y(){this.reset.apply(this,arguments)}function v(a){this.m_name=a;this.m_attributes={};this.m_flags=0}function O(a){a=a.toLowerCase();return a.substr(0,7)=="http://"||a.substr(0,8)=="https://"||a.substr(0,6)=="ftp://"}function z(a){var b=a.m_position,c=X(a);
if(c!=null)return c;a.m_position=b;return null}function X(a){if(a.current()!="<")return null;a.SkipForward(1);if(a.SkipString("!--")){a.Mark();if(a.Find("--\>")){var b=new v("!");b.m_attributes.content=a.Extract();b.closed=true;a.SkipForward(3);return b}}var c=a.SkipChar("/");a.Mark();if(!a.SkipIdentifier())return null;b=new v(a.Extract());if(b.closing=c){if(a.current()!=">")return null;a.SkipForward(1);return b}for(;!a.eof();){a.SkipWhitespace();if(a.SkipString("/>")){b.closed=true;return b}if(a.SkipChar(">"))return b;
a.Mark();if(!a.SkipIdentifier())return null;c=a.Extract();a.SkipWhitespace();if(!a.SkipChar("="))return null;a.SkipWhitespace();if(a.SkipChar('"')){a.Mark();if(!a.Find('"'))return null;b.m_attributes[c]=a.Extract();a.SkipForward(1)}else{for(a.Mark();!a.eof()&&!n(a.current())&&a.current()!=">"&&a.current()!="/";)a.SkipForward(1);a.eof()||(b.m_attributes[c]=a.Extract())}}return null}function A(a,b,c){this.id=a;this.url=b;this.title=c==undefined?null:c}function Y(a,b){a.SkipWhitespace();if(!a.SkipChar("["))return null;
a.Mark();if(!a.Find("]"))return null;var c=a.Extract();if(c.length==0)return null;if(!a.SkipString("]:"))return null;c=P(a,c,b);a.SkipLinespace();if(!a.eol())return null;return c}function P(a,b,c){a.SkipWhitespace();if(a.eol())return null;var d=new A(b);if(a.SkipChar("<")){for(a.Mark();a.current()!=">";){if(a.eof())return null;a.SkipEscapableChar(c)}var e=a.Extract();if(!a.SkipChar(">"))return null;d.url=u(t(e),c);a.SkipWhitespace()}else{a.Mark();for(e=1;!a.eol();){var g=a.current();if(n(g))break;
if(b==null)if(g=="(")e++;else if(g==")"){e--;if(e==0)break}a.SkipEscapableChar(c)}d.url=u(t(a.Extract()),c)}a.SkipLinespace();if(a.current()==")")return d;e=a.eol();g=a.m_position;if(a.eol()){a.SkipEol();a.SkipLinespace()}switch(a.current()){case "'":case '"':e=a.current();break;case "(":e=")";break;default:if(e){a.m_position=g;return d}else return null}a.SkipForward(1);for(a.Mark();;){if(a.eol())return null;if(a.current()==e){if(e!=")"){g=a.m_position;a.SkipForward(1);a.SkipLinespace();if(b==null&&
a.current()!=")"||b!=null&&!a.eol())continue;a.m_position=g}break}a.SkipEscapableChar(c)}d.title=u(a.Extract(),c);a.SkipForward(1);return d}function B(a,b){this.def=a;this.link_text=b}function Q(a,b,c){this.type=a;this.startOffset=b;this.length=c;this.data=null}function C(a){this.m_Markdown=a;this.m_Scanner=new y;this.m_SpareTokens=[];this.m_DisableLinks=false;this.m_Tokens=[]}function J(){}function r(a,b){this.m_Markdown=a;this.m_parentType=k;this.m_bMarkdownInHtml=b}function K(){this.m_Columns=
[];this.m_Headers=null;this.m_Rows=[]}function Z(a){a.SkipLinespace();if(a.current()!="|"&&a.current()!=":"&&a.current()!="-")return null;var b=null;if(a.SkipChar("|")){b=new K;b.LeadingBar=true}for(;;){a.SkipLinespace();if(a.current()=="|")return null;for(var c=a.SkipChar(":");a.current()=="-";)a.SkipForward(1);var d=a.SkipChar(":");a.SkipLinespace();var e=$;if(c&&d)e=R;else if(c)e=S;else if(d)e=T;if(a.eol()){if(b==null)return null;b.m_Columns.push(e);return b}if(!a.SkipChar("|"))return null;if(b==
null)b=new K;b.m_Columns.push(e);a.SkipLinespace();if(a.eol()){b.TrailingBar=true;return b}}}p.prototype={SafeMode:false,ExtraMode:false,MarkdownInHtml:false,AutoHeadingIDs:false,UrlBaseLocation:null,NewWindowForExternalLinks:false,NewWindowForLocalLinks:false,NoFollowLinks:false,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null};var f=p.prototype;p.prototype.Transform=function(a){var b=this.ProcessBlocks(a);if(this.m_Abbreviations!=null){a=[];for(var c in this.m_Abbreviations)a.push(this.m_Abbreviations[c]);
a.sort(function(g,h){return h.Abbr.length-g.Abbr.length});this.m_Abbreviations=a}c=this.m_StringBuilderFinal;c.Clear();for(a=0;a<b.length;a++)b[a].Render(this,c);if(this.m_UsedFootnotes.length>0){c.Append('\n<div class="');c.Append(this.HtmlClassFootnotes);c.Append('">\n');c.Append("<hr />\n");c.Append("<ol>\n");for(a=0;a<this.m_UsedFootnotes.length;a++){b=this.m_UsedFootnotes[a];c.Append('<li id="#fn:');c.Append(b.data);c.Append('">\n');var d='<a href="#fnref:'+b.data+'" rev="footnote">&#8617;</a>',
e=b.children[b.children.length-1];if(e.blockType==m){e.blockType=L;e.data=d}else{e=new J;e.contentLen=0;e.blockType=L;e.data=d;b.children.push(e)}b.Render(this,c);c.Append("</li>\n")}c.Append("</ol\n");c.Append("</div>\n")}return c.ToString()};p.prototype.OnQualifyUrl=function(a){if(!this.UrlBaseLocation)return a;if(I(a))return a;if(a.substr(0,1)=="/"){var b=this.UrlBaseLocation.indexOf("://");if(b==-1)b=0;else b+=3;b=this.UrlBaseLocation.indexOf("/",b);return(b<0?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,
b))+a}else return this.UrlBaseLocation.substr(-1)=="/"?this.UrlBaseLocation+a:this.UrlBaseLocation+"/"+a};p.prototype.OnGetImageSize=function(){return null};p.prototype.OnPrepareLink=function(a){var b=a.m_attributes.href;if(this.NoFollowLinks)a.m_attributes.rel="nofollow";if(this.NewWindowForExternalLinks&&I(b)||this.NewWindowForLocalLinks&&!I(b))a.m_attributes.target="_blank";a.m_attributes.href=this.OnQualifyUrl(b)};p.prototype.OnPrepareImage=function(a){var b=this.OnGetImageSize(a.m_attributes.src);
if(b!=null){a.m_attributes.width=b.width;a.m_attributes.height=b.height}a.m_attributes.src=this.OnQualifyUrl(a.m_attributes.src)};f.ProcessBlocks=function(a){var b=a.indexOf("\r");if(b>=0){var c=a.indexOf("\n");if(c>=0)a=c<b?a.replace(/\n\r/g,"\n"):a.replace(/\r\n/g,"\n");a=a.replace(/\r/g,"\n")}this.m_LinkDefinitions=[];this.m_Footnotes=[];this.m_UsedFootnotes=[];this.m_UsedHeaderIDs=[];this.m_Abbreviations=null;return(new r(this,this.MarkdownInHtml)).Process(a)};f.AddLinkDefinition=function(a){this.m_LinkDefinitions[a.id]=
a};f.GetLinkDefinition=function(a){a=this.m_LinkDefinitions[a];return a==undefined?null:a};f.AddFootnote=function(a){this.m_Footnotes[a.data]=a};f.ClaimFootnote=function(a){var b=this.m_Footnotes[a];if(b!=undefined){this.m_UsedFootnotes.push(b);delete this.m_Footnotes[a];return this.m_UsedFootnotes.length-1}else return-1};f.AddAbbreviation=function(a,b){if(this.m_Abbreviations==null)this.m_Abbreviations=[];this.m_Abbreviations[a]={Abbr:a,Title:b}};f.GetAbbreviations=function(){return this.m_Abbreviations};
f.MakeUniqueHeaderID=function(a,b,c){if(!this.AutoHeadingIDs)return null;(a=this.m_SpanFormatter.MakeID(a,b,c))||(a="section");b=a;for(c=1;this.m_UsedHeaderIDs[b]!=undefined;){b=a+"-"+c.toString();c++}this.m_UsedHeaderIDs[b]=true;return b};f.GetStringBuilder=function(){this.m_StringBuilder.Clear();return this.m_StringBuilder};f=q.prototype;f.Append=function(a){a&&this.m_content.push(a)};f.Clear=function(){this.m_content.length=0};f.ToString=function(){return this.m_content.join("")};f.HtmlRandomize=
function(a){for(var b=a.length,c=0;c<b;c++){var d=Math.random();if(d>0.9&&a.charAt(c)!="@")this.Append(a.charAt(c));else{if(d>0.45){this.Append("&#");this.Append(a.charCodeAt(c).toString())}else{this.Append("&#x");this.Append(a.charCodeAt(c).toString(16))}this.Append(";")}}};f.HtmlEncode=function(a,b,c){c=b+c;var d=b;for(b=b;b<c;b++)switch(a.charAt(b)){case "&":b>d&&this.Append(a.substr(d,b-d));this.Append("&amp;");d=b+1;break;case "<":b>d&&this.Append(a.substr(d,b-d));this.Append("&lt;");d=b+1;break;
case ">":b>d&&this.Append(a.substr(d,b-d));this.Append("&gt;");d=b+1;break;case '"':b>d&&this.Append(a.substr(d,b-d));this.Append("&quot;");d=b+1;break}b>d&&this.Append(a.substr(d,b-d))};f.SmartHtmlEncodeAmpsAndAngles=function(a,b,c){c=b+c;var d=b;for(b=b;b<c;b++)switch(a.charAt(b)){case "&":var e=H(a,b);if(e<0){b>d&&this.Append(a.substr(d,b-d));this.Append("&amp;");d=b+1}else b=e-1;break;case "<":b>d&&this.Append(a.substr(d,b-d));this.Append("&lt;");d=b+1;break;case ">":b>d&&this.Append(a.substr(d,
b-d));this.Append("&gt;");d=b+1;break;case '"':b>d&&this.Append(a.substr(d,b-d));this.Append("&quot;");d=b+1;break}b>d&&this.Append(a.substr(d,b-d))};f.SmartHtmlEncodeAmps=function(a,b,c){c=b+c;var d=b;for(b=b;b<c;b++)switch(a.charAt(b)){case "&":var e=H(a,b);if(e<0){b>d&&this.Append(a.substr(d,b-d));this.Append("&amp;");d=b+1}else b=e-1;break}b>d&&this.Append(a.substr(d,b-d))};f.HtmlEncodeAndConvertTabsToSpaces=function(a,b,c){c=b+c;var d=b,e=0;for(b=b;b<c;b++){switch(a.charAt(b)){case "\t":b>d&&
this.Append(a.substr(d,b-d));d=b+1;this.Append(" ");for(e++;e%4!=0;){this.Append(" ");e++}e--;break;case "\r":case "\n":b>d&&this.Append(a.substr(d,b-d));this.Append("\n");d=b+1;continue;case "&":b>d&&this.Append(a.substr(d,b-d));this.Append("&amp;");d=b+1;break;case "<":b>d&&this.Append(a.substr(d,b-d));this.Append("&lt;");d=b+1;break;case ">":b>d&&this.Append(a.substr(d,b-d));this.Append("&gt;");d=b+1;break;case '"':b>d&&this.Append(a.substr(d,b-d));this.Append("&quot;");d=b+1;break}e++}b>d&&this.Append(a.substr(d,
b-d))};f=y.prototype;f.bof=function(){return this.m_position==this.start};f.eof=function(){return this.m_position>=this.end};f.eol=function(){if(this.m_position>=this.end)return true;var a=this.buf.charAt(this.m_position);return a=="\r"||a=="\n"||a==undefined||a==""};f.reset=function(){this.buf=arguments.length>0?arguments[0]:null;this.start=arguments.length>1?arguments[1]:0;this.end=arguments.length>2?this.start+arguments[2]:this.buf==null?0:this.buf.length;this.m_position=this.start;this.charset_offsets=
{}};f.current=function(){if(this.m_position>=this.end)return"\u0000";return this.buf.charAt(this.m_position)};f.remainder=function(){return this.buf.substr(this.m_position)};f.SkipToEof=function(){this.m_position=this.end};f.SkipForward=function(a){this.m_position+=a};f.SkipToEol=function(){this.m_position=this.buf.indexOf("\n",this.m_position);if(this.m_position<0)this.m_position=this.end};f.SkipEol=function(){var a=this.m_position;this.buf.charAt(this.m_position)=="\r"&&this.m_position++;this.buf.charAt(this.m_position)==
"\n"&&this.m_position++;return this.m_position!=a};f.SkipToNextLine=function(){this.SkipToEol();this.SkipEol()};f.CharAtOffset=function(a){if(this.m_position+a>=this.end)return"\u0000";return this.buf.charAt(this.m_position+a)};f.SkipChar=function(a){if(this.buf.charAt(this.m_position)==a){this.m_position++;return true}return false};f.SkipString=function(a){if(this.buf.substr(this.m_position,a.length)==a){this.m_position+=a.length;return true}return false};f.SkipWhitespace=function(){for(var a=this.m_position;;){var b=
this.buf.charAt(this.m_position);if(b!=" "&&b!="\t"&&b!="\r"&&b!="\n")break;this.m_position++}return this.m_position!=a};f.SkipLinespace=function(){for(var a=this.m_position;;){var b=this.buf.charAt(this.m_position);if(b!=" "&&b!="\t")break;this.m_position++}return this.m_position!=a};f.FindRE=function(a){a.lastIndex=this.m_position;a=a.exec(this.buf);if(a==null){this.m_position=this.end;return false}if(a.index+a[0].length>this.end){this.m_position=this.end;return false}this.m_position=a.index;return true};
f.FindOneOf=function(a){var b=-1;for(var c in a){var d=a[c];if(d==null){d={};d.m_searched_from=-1;d.m_found_at=-1;a[c]=d}if(d.m_searched_from==-1||this.m_position<d.m_searched_from||this.m_position>=d.m_found_at&&d.m_found_at!=-1){d.m_searched_from=this.m_position;d.m_found_at=this.buf.indexOf(c,this.m_position)}if(b==-1||d.m_found_at<b)b=d.m_found_at}if(b==-1)return false;f.m_position=b;return true};f.Find=function(a){this.m_position=this.buf.indexOf(a,this.m_position);if(this.m_position<0){this.m_position=
this.end;return false}return true};f.Mark=function(){this.mark=this.m_position};f.Extract=function(){return this.mark>=this.m_position?"":this.buf.substr(this.mark,this.m_position-this.mark)};f.SkipIdentifier=function(){var a=this.buf.charAt(this.m_position);if(a>="a"&&a<="z"||a>="A"&&a<="Z"||a=="_")for(this.m_position++;;){a=this.buf.charAt(this.m_position);if(a>="a"&&a<="z"||a>="A"&&a<="Z"||a=="_"||a>="0"&&a<="9")this.m_position++;else return true}return false};f.SkipFootnoteID=function(){var a=
this.m_position;this.SkipLinespace();for(this.Mark();;){var b=this.current();if(s(b)||b=="-"||b=="_"||b==":"||b=="."||b==" ")this.SkipForward(1);else break}if(this.m_position>this.mark){b=t(this.Extract());if(b.length>0){this.SkipLinespace();return b}}this.m_position=a;return null};f.SkipHtmlEntity=function(){if(this.buf.charAt(this.m_position)!="&")return false;var a=H(this.buf,this.m_position);if(a<0)return false;this.m_position=a;return true};f.SkipEscapableChar=function(a){if(this.buf.charAt(this.m_position)==
"\\"&&G(this.buf.charAt(this.m_position+1),a)){this.m_position+=2;return true}else{this.m_position<this.end&&this.m_position++;return false}};f=v.prototype;f.m_attributes=null;f.closed=false;f.closing=false;f.attributeCount=function(){if(!this.m_attributes)return 0;var a=0;for(var b in this.m_attributes)a++;return a};f.get_Flags=function(){if(this.m_flags==0){this.m_flags=aa[this.m_name.toLowerCase()];if(this.m_flags==undefined)this.m_flags=2}return this.m_flags};f.IsSafe=function(){var a=this.m_name.toLowerCase();
if(!ba[a])return false;a=ca[a];if(!a)return this.attributeCount()==0;if(!this.m_attributes)return true;for(var b in this.m_attributes)if(!a[b.toLowerCase()])return false;if(this.m_attributes.href)if(!O(this.m_attributes.href))return false;if(this.m_attributes.src)if(!O(this.m_attributes.src))return false;return true};f.RenderOpening=function(a){a.Append("<");a.Append(this.m_name);for(var b in this.m_attributes){a.Append(" ");a.Append(b);a.Append('="');a.Append(this.m_attributes[b]);a.Append('"')}this.closed?
a.Append(" />"):a.Append(">")};f.RenderClosing=function(a){a.Append("</");a.Append(this.m_name);a.Append(">")};var ba={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1},ca={a:{href:1,title:1},img:{src:1,width:1,height:1,alt:1,title:1}},aa={p:9,div:1,h1:9,h2:9,h3:9,h4:9,h5:9,h6:9,blockquote:1,pre:1,table:1,dl:1,ol:1,ul:1,form:1,fieldset:1,iframe:1,script:3,noscript:3,math:3,ins:3,del:3,img:3,
li:8,dd:8,dt:8,td:8,th:8,legend:8,address:8,hr:5,"!":5};delete 1;delete 2;delete 4;f=A.prototype;f.RenderLink=function(a,b,c){if(this.url.substr(0,7).toLowerCase()=="mailto:"){b.Append('<a href="');b.HtmlRandomize(this.url);b.Append('"');if(this.title){b.Append(' title="');b.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);b.Append('"')}b.Append(">");b.HtmlRandomize(c)}else{var d=new v("a"),e=a.GetStringBuilder();e.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);d.m_attributes.href=
e.ToString();if(this.title){e.Clear();e.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);d.m_attributes.title=e.ToString()}a.OnPrepareLink(d);d.RenderOpening(b);b.Append(c)}b.Append("</a>")};f.RenderImg=function(a,b,c){var d=new v("img"),e=a.GetStringBuilder();e.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);d.m_attributes.src=e.ToString();if(c){e.Clear();e.SmartHtmlEncodeAmpsAndAngles(c,0,c.length);d.m_attributes.alt=e.ToString()}if(this.title){e.Clear();e.SmartHtmlEncodeAmpsAndAngles(this.title,
0,this.title.length);d.m_attributes.title=e.ToString()}d.closed=true;a.OnPrepareImage(d);d.RenderOpening(b)};f=C.prototype;f.FormatParagraph=function(a,b,c,d){this.Tokenize(b,c,d);if(this.m_Tokens.length==1&&this.m_Markdown.HtmlClassTitledImages!=null&&this.m_Tokens[0].type==10){c=this.m_Tokens[0].data;a.Append('<div class="');a.Append(this.m_Markdown.HtmlClassTitledImages);a.Append('">\n');this.Render(a,b);a.Append("\n");if(c.def.title){a.Append("<p>");a.SmartHtmlEncodeAmpsAndAngles(c.def.title,
0,c.def.title.length);a.Append("</p>\n")}a.Append("</div>\n")}else{a.Append("<p>");this.Render(a,b);a.Append("</p>\n")}};f.Format2=function(a,b){this.Format(a,b,0,b.length)};f.Format=function(a,b,c,d){this.Tokenize(b,c,d);this.Render(a,b)};f.FormatDirect=function(a){var b=new q;this.Format(b,a,0,a.length);return b.ToString()};f.MakeID=function(a,b,c){this.Tokenize(a,b,c);c=this.m_Tokens;b=new q;for(var d=0;d<c.length;d++){var e=c[d];switch(e.type){case 0:b.Append(a.substr(e.startOffset,e.length));
break;case 9:b.Append(e.data.link_text);break}this.FreeToken(e)}a=this.m_Scanner;for(a.reset(b.ToString());!a.eof();){if(M(a.current()))break;a.SkipForward(1)}for(b.Clear();!a.eof();){c=a.current();if(s(c)||c=="_"||c=="-"||c==".")b.Append(c.toLowerCase());else if(c==" ")b.Append("-");else if(E(c)){b.Append("-");a.SkipEol();continue}a.SkipForward(1)}return b.ToString()};f.Render=function(a,b){for(var c=this.m_Tokens,d=c.length,e=0;e<d;e++){var g=c[e];switch(g.type){case 0:a.HtmlEncode(b,g.startOffset,
g.length);break;case 1:a.SmartHtmlEncodeAmps(b,g.startOffset,g.length);break;case 2:case 11:case 12:case 13:a.Append(b.substr(g.startOffset,g.length));break;case 8:a.Append("<br />\n");break;case 3:a.Append("<em>");break;case 4:a.Append("</em>");break;case 5:a.Append("<strong>");break;case 6:a.Append("</strong>");break;case 7:a.Append("<code>");a.HtmlEncode(b,g.startOffset,g.length);a.Append("</code>");break;case 9:var h=g.data,i=new C(this.m_Markdown);i.m_DisableLinks=true;h.def.RenderLink(this.m_Markdown,
a,i.FormatDirect(h.link_text));break;case 10:h=g.data;h.def.RenderImg(this.m_Markdown,a,h.link_text);break;case 14:h=g.data;a.Append('<sup id="fnref:');a.Append(h.id);a.Append('"><a href="#fn:');a.Append(h.id);a.Append('" rel="footnote">');a.Append(h.index+1);a.Append("</a></sup>");break;case 15:h=g.data;a.Append("<abbr");if(h.Title){a.Append(' title="');a.HtmlEncode(h.Title,0,h.Title.length);a.Append('"')}a.Append(">");a.HtmlEncode(h.Abbr,0,h.Abbr.length);a.Append("</abbr>");break}this.FreeToken(g)}};
f.Tokenize=function(a,b,c){var d=this.m_Scanner;d.reset(a,b,c);a=this.m_Tokens;a.length=0;b=null;c=this.m_Markdown.GetAbbreviations();for(var e=c==null?/[\*\_\`\[\!\<\&\ \\]/g:null,g=this.m_Markdown.ExtraMode,h=d.m_position;!d.eof();){if(e!=null&&!d.FindRE(e))break;var i=d.m_position,j=null;switch(d.current()){case "*":case "_":j=this.CreateEmphasisMark();if(j!=null)switch(j.type){case 13:case 11:case 12:if(b==null)b=[];b.push(j);break}break;case "`":j=this.ProcessCodeSpan();break;case "[":case "!":var l=
d.m_position;j=this.ProcessLinkOrImageOrFootnote();if(j==null)d.m_position=l;break;case "<":l=d.m_position;var o=z(d);if(o!=null)if(!this.m_Markdown.SafeMode||o.IsSafe())j=this.CreateToken(1,l,d.m_position-l);else d.m_position=l;else{d.m_position=l;j=this.ProcessAutoLink();if(j==null)d.m_position=l}break;case "&":l=d.m_position;if(d.SkipHtmlEntity())j=this.CreateToken(2,l,d.m_position-l);break;case " ":if(d.CharAtOffset(1)==" "&&E(d.CharAtOffset(2))){d.SkipForward(2);if(!d.eof()){d.SkipEol();j=this.CreateToken(8,
i,0)}}break;case "\\":if(G(d.CharAtOffset(1),g)){j=this.CreateToken(0,d.m_position+1,1);d.SkipForward(2)}break}if(j==null&&c!=null&&!s(d.CharAtOffset(-1))){l=d.m_position;for(var da in c){o=c[da];if(d.SkipString(o.Abbr)&&!s(d.current())){j=this.CreateDataToken(15,o);break}d.position=l}}if(j!=null){i>h&&a.push(this.CreateToken(0,h,i-h));a.push(j);h=d.m_position}else d.SkipForward(1)}d.m_position>h&&a.push(this.CreateToken(0,h,d.m_position-h));b!=null&&this.ResolveEmphasisMarks(a,b)};f.CreateEmphasisMark=
function(){var a=this.m_Scanner,b=a.current(),c=a.m_position;if(a.bof()||n(a.CharAtOffset(-1))){for(;F(a.current());)a.SkipForward(1);if(a.eof()||n(a.current()))return this.CreateToken(2,c,a.m_position-c);a.m_position=c}for(;F(a.CharAtOffset(-1));)a.SkipForward(-1);var d=a.bof()||n(a.CharAtOffset(-1));for(a.m_position=c;a.current()==b;)a.SkipForward(1);for(var e=a.m_position-c;F(a.CharAtOffset(1));)a.SkipForward(1);var g=a.eof()||n(a.current());a.m_position=c+e;if(d)return this.CreateToken(11,c,a.m_position-
c);if(g)return this.CreateToken(12,c,a.m_position-c);if(this.m_Markdown.ExtraMode&&b=="_")return null;return this.CreateToken(13,c,a.m_position-c)};f.SplitMarkToken=function(a,b,c,d){var e=this.CreateToken(c.type,c.startOffset+d,c.length-d);c.length=d;b.splice(w(b,c)+1,0,e);a.splice(w(a,c)+1,0,e);return e};f.ResolveEmphasisMarks=function(a,b){for(var c=this.m_Scanner.buf,d=true;d;){d=false;for(var e=0;e<b.length;e++){var g=b[e];if(!(g.type!=11&&g.type!=13))for(var h=e+1;h<b.length;h++){var i=b[h];
if(i.type!=12&&i.type!=13)break;if(c.charAt(g.startOffset)==c.charAt(i.startOffset)){d=Math.min(g.length,i.length);if(d>=3)d=d%2==1?1:2;if(g.length>d){g=this.SplitMarkToken(a,b,g,g.length-d);e--}i.length>d&&this.SplitMarkToken(a,b,i,d);g.type=d==1?3:5;i.type=d==1?4:6;b.splice(w(b,g),1);b.splice(w(b,i),1);d=true;break}}}}};f.ProcessAutoLink=function(){if(this.m_DisableLinks)return null;var a=this.m_Scanner;a.SkipForward(1);a.Mark();for(var b=this.m_Markdown.ExtraMode;!a.eof();){var c=a.current();if(n(c))break;
if(c==">"){b=u(a.Extract(),b);c=null;var d;d=b;var e=d.indexOf("@");d=e<0?false:d.lastIndexOf(".")<e?false:true;if(d){if(b.toLowerCase().substr(0,7)=="mailto:")c=b.substr(7);else{c=b;b="mailto:"+b}c=new B(new A("auto",b,null),c)}else if(V(b))c=new B(new A("auto",b,null),b);if(c!=null){a.SkipForward(1);return this.CreateDataToken(9,c)}return null}a.SkipEscapableChar(b)}return null};f.ProcessLinkOrImageOrFootnote=function(){var a=this.m_Scanner,b=a.SkipChar("!")?10:9;if(!a.SkipChar("["))return null;
var c=this.m_position;if(this.m_Markdown.ExtraMode&&b==9&&a.SkipChar("^")){a.SkipLinespace();a.Mark();var d=a.SkipFootnoteID();if(d!=null&&a.SkipChar("]")){var e=this.m_Markdown.ClaimFootnote(d);if(e>=0)return this.CreateDataToken(14,{index:e,id:d})}this.m_position=c}if(this.m_DisableLinks)return null;d=this.m_Markdown.ExtraMode;a.Mark();for(e=1;!a.eof();){c=a.current();if(c=="[")e++;else if(c=="]"){e--;if(e==0)break}a.SkipEscapableChar(d)}if(a.eof())return null;d=u(a.Extract(),d);a.SkipForward(1);
c=a.m_position;if(a.SkipChar("(")){e=P(a,null,this.m_Markdown.ExtraMode);if(e==null)return null;a.SkipWhitespace();if(!a.SkipChar(")"))return null;return this.CreateDataToken(b,new B(e,d))}a.SkipChar(" ")||a.SkipChar("\t");if(a.eol()){a.SkipEol();a.SkipLinespace()}e=null;if(a.current()=="["){a.SkipForward(1);a.Mark();if(!a.Find("]"))return null;e=a.Extract();a.SkipForward(1)}else a.m_position=c;if(!e)for(e=d;;){c=e.indexOf("\n");if(c<0)break;for(a=c;a>0&&n(e.charAt(a-1));)a--;for(c=c;c<e.length&&
n(e.charAt(c));)c++;e=e.substr(0,a)+" "+e.substr(c)}a=this.m_Markdown.GetLinkDefinition(e);if(a==null)return null;return this.CreateDataToken(b,new B(a,d))};f.ProcessCodeSpan=function(){for(var a=this.m_Scanner,b=a.m_position,c=0;a.SkipChar("`");)c++;a.SkipWhitespace();if(a.eof())return this.CreateToken(0,b,a.m_position-b);var d=a.m_position;if(!a.Find(a.buf.substr(b,c)))return this.CreateToken(0,b,a.m_position-b);for(b=a.m_position+c;n(a.CharAtOffset(-1));)a.SkipForward(-1);d=this.CreateToken(7,
d,a.m_position-d);a.m_position=b;return d};f.CreateToken=function(a,b,c){if(this.m_SpareTokens.length!=0){var d=this.m_SpareTokens.pop();d.type=a;d.startOffset=b;d.length=c;d.data=null;return d}else return new Q(a,b,c)};f.CreateDataToken=function(a,b){if(this.m_SpareTokens.length!=0){var c=this.m_SpareTokens.pop();c.type=a}else c=new Q(a,0,0);c.data=b;return c};f.FreeToken=function(a){a.data=null;this.m_SpareTokens.push(a)};var k=0,m=12,L=29;f=J.prototype;f.buf=null;f.blockType=k;f.contentStart=0;
f.contentLen=0;f.lineStart=0;f.lineLen=0;f.children=null;f.data=null;f.get_Content=function(){if(this.buf==null)return null;if(this.contentStart==-1)return this.buf;return this.buf.substr(this.contentStart,this.contentLen)};f.get_CodeContent=function(){for(var a=new q,b=0;b<this.children.length;b++){a.Append(this.children[b].get_Content());a.Append("\n")}return a.ToString()};f.RenderChildren=function(a,b){for(var c=0;c<this.children.length;c++)this.children[c].Render(a,b)};f.ResolveHeaderID=function(a){if(this.data!=
null)return this.data;var b=N(this.buf,this.contentStart,this.get_contentEnd()),c=null;if(b!=null){this.set_contentEnd(b.end);c=b.id}else c=a.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen);return this.data=c};f.Render=function(a,b){switch(this.blockType){case k:return;case m:a.m_SpanFormatter.FormatParagraph(b,this.buf,this.contentStart,this.contentLen);break;case 17:a.m_SpanFormatter.Format(b,this.buf,this.contentStart,this.contentLen);b.Append("\n");break;case 1:case 2:case 3:case 4:case 5:case 6:if(a.ExtraMode&&
!a.SafeMode){b.Append("<h"+(this.blockType-1+1).toString());var c=this.ResolveHeaderID(a);if(c){b.Append(' id="');b.Append(c);b.Append('">')}else b.Append(">")}else b.Append("<h"+(this.blockType-1+1).toString()+">");a.m_SpanFormatter.Format(b,this.buf,this.contentStart,this.contentLen);b.Append("</h"+(this.blockType-1+1).toString()+">\n");break;case 14:b.Append("<hr />\n");return;case 10:case 11:b.Append("<li>");a.m_SpanFormatter.Format(b,this.buf,this.contentStart,this.contentLen);b.Append("</li>\n");
break;case 15:b.Append(this.buf.substr(this.contentStart,this.contentLen));return;case 16:b.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case 18:b.Append("<pre><code>");for(c=0;c<this.children.length;c++){var d=this.children[c];b.HtmlEncodeAndConvertTabsToSpaces(d.buf,d.contentStart,d.contentLen);b.Append("\n")}b.Append("</code></pre>\n\n");return;case 9:b.Append("<blockquote>\n");this.RenderChildren(a,b);b.Append("</blockquote>\n");return;case 19:b.Append("<li>\n");this.RenderChildren(a,
b);b.Append("</li>\n");return;case 20:b.Append("<ol>\n");this.RenderChildren(a,b);b.Append("</ol>\n");return;case 21:b.Append("<ul>\n");this.RenderChildren(a,b);b.Append("</ul>\n");return;case 22:c=this.data;d=c.m_name.toLowerCase();if(d=="a")a.OnPrepareLink(c);else d=="img"&&a.OnPrepareImage(c);c.RenderOpening(b);b.Append("\n");this.RenderChildren(a,b);c.RenderClosing(b);b.Append("\n");return;case 23:case 28:this.RenderChildren(a,b);return;case 24:this.data.Render(a,b);return;case 25:b.Append("<dd>");
if(this.children!=null){b.Append("\n");this.RenderChildren(a,b)}else a.m_SpanFormatter.Format(b,this.buf,this.contentStart,this.contentLen);b.Append("</dd>\n");break;case 26:if(this.children==null){d=this.get_Content().split("\n");for(c=0;c<d.length;c++){var e=d[c];b.Append("<dt>");a.m_SpanFormatter.Format2(b,t(e));b.Append("</dt>\n")}}else{b.Append("<dt>\n");this.RenderChildren(a,b);b.Append("</dt>\n")}break;case 27:b.Append("<dl>\n");this.RenderChildren(a,b);b.Append("</dl>\n");return;case L:b.Append("<p>");
if(this.contentLen>0){a.m_SpanFormatter.Format(b,this.buf,this.contentStart,this.contentLen);b.Append("&nbsp;")}b.Append(this.data);b.Append("</p>\n");break}};f.RevertToPlain=function(){this.blockType=m;this.contentStart=this.lineStart;this.contentLen=this.lineLen};f.get_contentEnd=function(){return this.contentStart+this.contentLen};f.set_contentEnd=function(a){this.contentLen=a-this.contentStart};f.get_leadingSpaces=function(){for(var a=0,b=this.lineStart;b<this.lineStart+this.lineLen;b++)if(this.buf.charAt(b)==
" ")a++;else break;return a};f.CopyFrom=function(a){this.blockType=a.blockType;this.buf=a.buf;this.contentStart=a.contentStart;this.contentLen=a.contentLen;this.lineStart=a.lineStart;this.lineLen=a.lineLen;return this};f=r.prototype;f.Process=function(a){return this.ScanLines(new y(a))};f.ProcessRange=function(a,b,c){return this.ScanLines(new y(a,b,c))};f.StartTable=function(a,b,c){if(c.length>1)return false;if(c.length==1){var d=a.m_position;a.m_position=c[0].lineStart;b.m_Headers=b.ParseRow(a);
if(b.m_Headers==null)return false;a.m_position=d;c.length=0}for(;;){d=a.m_position;c=b.ParseRow(a);if(c!=null)b.m_Rows.push(c);else{a.m_position=d;break}}return true};f.ScanLines=function(a){for(var b=[],c=[],d=-1;!a.eof();){var e=d==k,g=this.EvaluateLine(a);d=g.blockType;if(g.blockType==25)g.data=e;if(g.blockType==7||g.blockType==8){if(c.length>0){e=c.pop();this.CollapseLines(b,c);if(e.blockType!=k){e.RevertToPlain();e.blockType=g.blockType==7?1:2;b.push(e);continue}}if(g.blockType==7){g.RevertToPlain();
c.push(g)}else if(g.contentLen>=3){g.blockType=14;b.push(g)}else{g.RevertToPlain();c.push(g)}}else{e=c.length>0?c[0].blockType:k;if(g.blockType==24){var h=a.m_position;if(this.StartTable(a,g.data,c)){b.push(g);continue}else{a.m_position=h;g.RevertToPlain()}}switch(g.blockType){case k:switch(e){case k:this.FreeBlock(g);break;case m:this.CollapseLines(b,c);this.FreeBlock(g);break;case 9:case 10:case 11:case 25:case 28:case 13:c.push(g);break}break;case m:switch(e){case k:case m:c.push(g);break;case 9:case 10:case 11:case 25:case 28:e=
c[c.length-1];e.blockType==k&&this.CollapseLines(b,c);c.push(g);break;case 13:this.CollapseLines(b,c);c.push(g);break}break;case 13:switch(e){case k:c.push(g);break;case m:case 9:e=c[c.length-1];e.blockType==k?this.CollapseLines(b,c):g.RevertToPlain();c.push(g);break;case 10:case 11:case 13:case 25:case 28:c.push(g);break}break;case 9:e!=9&&this.CollapseLines(b,c);c.push(g);break;case 10:case 11:switch(e){case k:c.push(g);break;case m:case 9:e=c[c.length-1];e.blockType==k||this.m_parentType==10||
this.m_parentType==11||this.m_parentType==25?this.CollapseLines(b,c):g.RevertToPlain();c.push(g);break;case 10:case 11:case 25:case 28:g.blockType!=e&&this.CollapseLines(b,c);c.push(g);break;case 13:this.CollapseLines(b,c);c.push(g);break}break;case 25:case 28:switch(e){case k:case m:case 25:case 28:this.CollapseLines(b,c);c.push(g);break;default:g.RevertToPlain();c.push(g);break}break;default:this.CollapseLines(b,c);b.push(g);break}}}this.CollapseLines(b,c);this.m_Markdown.ExtraMode&&this.BuildDefinitionLists(b);
return b};f.CreateBlock=function(){return this.m_Markdown.m_SpareBlocks.length>1?this.m_Markdown.m_SpareBlocks.pop():new J};f.FreeBlock=function(a){this.m_Markdown.m_SpareBlocks.push(a)};f.FreeBlocks=function(a){for(var b=0;b<a.length;b++)this.m_Markdown.m_SpareBlocks.push(a[b]);a.length=0};f.RenderLines=function(a){for(var b=this.m_Markdown.GetStringBuilder(),c=0;c<a.length;c++){var d=a[c];b.Append(d.buf.substr(d.contentStart,d.contentLen));b.Append("\n")}return b.ToString()};f.CollapseLines=function(a,
b){for(;b.length>0&&b[b.length-1].blockType==k;)this.FreeBlock(b.pop());if(b.length!=0)switch(b[0].blockType){case m:var c=this.CreateBlock();c.blockType=m;c.buf=b[0].buf;c.contentStart=b[0].contentStart;c.set_contentEnd(b[b.length-1].get_contentEnd());a.push(c);this.FreeBlocks(b);break;case 9:c=this.RenderLines(b);var d=new r(this.m_Markdown,this.m_bMarkdownInHtml);d.m_parentType=9;var e=this.CreateBlock();e.blockType=9;e.children=d.Process(c);this.FreeBlocks(b);a.push(e);break;case 10:case 11:a.push(this.BuildList(b));
break;case 25:if(a.length>0){c=a[a.length-1];switch(c.blockType){case m:c.blockType=26;break;case 25:break;default:d=this.CreateBlock();d.blockType=26;d.children=[];d.children.push(c);a.pop();a.push(d);break}}a.push(this.BuildDefinition(b));break;case 28:this.m_Markdown.AddFootnote(this.BuildFootnote(b));break;case 13:c=this.CreateBlock();c.blockType=18;c.children=[];for(d=0;d<b.length;d++)c.children.push(b[d]);a.push(c);b.length=0;break}};f.EvaluateLine=function(a){var b=this.CreateBlock();b.lineStart=
a.m_position;b.buf=a.buf;b.contentStart=a.m_position;b.contentLen=-1;b.blockType=this.EvaluateLineInternal(a,b);if(b.contentLen<0){a.SkipToEol();b.contentLen=a.m_position-b.contentStart}b.lineLen=a.m_position-b.lineStart;a.SkipEol();return b};f.EvaluateLineInternal=function(a,b){if(a.eol())return k;var c=a.m_position,d=a.current();if(d=="#"){c=1;for(a.SkipForward(1);a.current()=="#";){c++;a.SkipForward(1)}if(c>6)c=6;a.SkipLinespace();b.contentStart=a.m_position;a.SkipToEol();if(this.m_Markdown.ExtraMode&&
!this.m_Markdown.SafeMode){d=N(a.buf,b.contentStart,a.m_position);if(d!=null){b.data=d.id;a.m_position=d.end}}for(;a.m_position>b.contentStart&&a.CharAtOffset(-1)=="#";)a.SkipForward(-1);for(;a.m_position>b.contentStart&&n(a.CharAtOffset(-1));)a.SkipForward(-1);b.contentLen=a.m_position-b.contentStart;a.SkipToEol();return 1+(c-1)}if(d=="-"||d=="="){for(var e=d;a.current()==e;)a.SkipForward(1);a.SkipLinespace();if(a.eol())return e=="="?7:8;a.m_position=c}if(this.m_Markdown.ExtraMode){e=Z(a);if(e!=
null){b.data=e;return 24}a.m_position=c;if(d=="~"){if(this.ProcessFencedCodeBlock(a,b))return b.blockType;a.m_position=c}}d=-1;for(e=0;!a.eol();){if(a.current()==" ")d<0&&e++;else if(a.current()=="\t"){if(d<0)d=a.m_position}else break;a.SkipForward(1)}if(a.eol()){b.contentLen=0;return k}if(e>=4){b.contentStart=c+4;return 13}if(d>=0&&d-c<4){b.contentStart=d+1;return 13}b.contentStart=a.m_position;d=a.current();if(d=="<"){if(this.ScanHtml(a,b))return b.blockType;a.m_position=b.contentStart}if(d==">"){if(x(a.CharAtOffset(1))){a.SkipForward(2);
b.contentStart=a.m_position;return 9}a.SkipForward(1);b.contentStart=a.m_position;return 9}if(d=="-"||d=="_"||d=="*"){for(c=0;!a.eol();){a.current();if(a.current()==d){c++;a.SkipForward(1)}else if(x(a.current()))a.SkipForward(1);else break}if(a.eol()&&c>=3)return 14;a.m_position=b.contentStart}if(this.m_Markdown.ExtraMode&&d=="*"&&a.CharAtOffset(1)=="["){a.SkipForward(2);a.SkipLinespace();for(a.Mark();!a.eol()&&a.current()!="]";)a.SkipForward(1);c=t(a.Extract());if(a.current()=="]"&&a.CharAtOffset(1)==
":"&&c){a.SkipForward(2);a.SkipLinespace();a.Mark();a.SkipToEol();d=a.Extract();this.m_Markdown.AddAbbreviation(c,d);return k}a.m_position=b.contentStart}if((d=="*"||d=="+"||d=="-")&&x(a.CharAtOffset(1))){a.SkipForward(1);a.SkipLinespace();b.contentStart=a.m_position;return 11}if(d==":"&&this.m_Markdown.ExtraMode&&x(a.CharAtOffset(1))){a.SkipForward(1);a.SkipLinespace();b.contentStart=a.m_position;return 25}if(D(d)){for(a.SkipForward(1);D(a.current());)a.SkipForward(1);if(a.SkipChar(".")&&a.SkipLinespace()){b.contentStart=
a.m_position;return 10}a.m_position=b.contentStart}if(d=="["){if(this.m_Markdown.ExtraMode&&a.CharAtOffset(1)=="^"){c=a.m_position;a.SkipForward(2);d=a.SkipFootnoteID();if(d!=null&&a.SkipChar("]")&&a.SkipChar(":")){a.SkipLinespace();b.contentStart=a.m_position;b.data=d;return 28}a.m_position=c}c=a.m_position;d=Y(a,this.m_Markdown.ExtraMode);if(d==null)a.m_position=c;if(d!=null){this.m_Markdown.AddLinkDefinition(d);return k}}return m};f.GetMarkdownMode=function(a){var b=a.m_attributes.markdown;if(b==
undefined)return this.m_bMarkdownInHtml?3:0;delete a.m_attributes.markdown;if(b=="1")return(a.get_Flags()&8)!=0?2:1;if(b=="block")return 1;if(b=="deep")return 3;if(b=="span")return 2;return 4};f.ProcessMarkdownEnabledHtml=function(a,b,c,d){for(var e=a.m_position,g=1,h=false;!a.eof();){if(!a.Find("<"))break;var i=a.m_position,j=z(a);if(j==null)a.SkipForward(1);else{if(this.m_Markdown.SafeMode&&d==4&&!h)j.IsSafe()||(h=true);if(!j.closed)if(j.m_name==c.m_name)if(j.closing){g--;if(g==0){a.SkipLinespace();
a.SkipEol();b.blockType=22;b.data=c;b.set_contentEnd(a.m_position);switch(d){case 2:c=this.CreateBlock();c.buf=a.buf;c.blockType=17;c.contentStart=e;c.contentLen=i-e;b.children=[];b.children.push(c);break;case 1:case 3:c=new r(this.m_Markdown,d==3);b.children=c.ProcessRange(a.buf,e,i-e);break;case 4:if(h){b.blockType=16;b.set_contentEnd(a.m_position)}else{c=this.CreateBlock();c.buf=a.buf;c.blockType=15;c.contentStart=e;c.contentLen=i-e;b.children=[];b.children.push(c)}break}return true}}else g++}}return false};
f.ScanHtml=function(a,b){var c=a.m_position,d=z(a);if(d==null)return false;if(d.closing)return false;var e=false;if(this.m_Markdown.SafeMode&&!d.IsSafe())e=true;var g=d.get_Flags();if((g&1)==0)return false;if((g&4)!=0||d.closed){a.SkipLinespace();a.SkipEol();b.contentLen=a.m_position-b.contentStart;b.blockType=e?16:15;return true}if((g&2)!=0){a.SkipLinespace();if(!a.eol())return false}if(this.m_Markdown.ExtraMode){var h=this.GetMarkdownMode(d);if(h!=0)return this.ProcessMarkdownEnabledHtml(a,b,d,
h)}g=null;for(var i=1;!a.eof();){if(!a.Find("<"))break;var j=a.m_position,l=z(a);if(l==null)a.SkipForward(1);else{if(this.m_Markdown.SafeMode&&!l.IsSafe())e=true;if(!l.closed){if(!l.closing&&this.m_Markdown.ExtraMode&&!e){h=this.GetMarkdownMode(l);if(h!=0){var o=this.CreateBlock();if(this.ProcessMarkdownEnabledHtml(a,o,l,h)){if(g==null)g=[];if(j>c){h=this.CreateBlock();h.buf=a.buf;h.blockType=15;h.contentStart=c;h.contentLen=j-c;g.push(h)}g.push(o);c=a.m_position;continue}else this.FreeBlock(o)}}if(l.m_name==
d.m_name&&!l.closed)if(l.closing){i--;if(i==0){a.SkipLinespace();a.SkipEol();if(e){b.blockType=16;b.set_contentEnd(a.m_position);return true}if(g!=null){if(a.m_position>c){h=this.CreateBlock();h.buf=a.buf;h.blockType=15;h.contentStart=c;h.contentLen=a.m_position-c;g.push(h)}b.blockType=23;b.set_contentEnd(a.m_position);b.children=g;return true}b.blockType=15;b.contentLen=a.m_position-b.contentStart;return true}}else i++}}}return k};f.BuildList=function(a){for(var b=a[0].blockType,c=a[0].get_leadingSpaces(),
d=1;d<a.length;d++)if(a[d].blockType==m&&(a[d-1].blockType==m||a[d-1].blockType==b)){a[d-1].set_contentEnd(a[d].get_contentEnd());this.FreeBlock(a[d]);a.splice(d,1);d--}else if(a[d].blockType!=13&&a[d].blockType!=k){var e=a[d].get_leadingSpaces();if(e>c){a[d].blockType=13;var g=a[d].get_contentEnd();a[d].contentStart=a[d].lineStart+e;a[d].set_contentEnd(g)}}c=this.CreateBlock();c.blockType=b==11?21:20;c.children=[];for(d=0;d<a.length;d++){for(var h=d;h>0&&a[h-1].blockType==k;)h--;for(e=d;e<a.length-
1&&a[e+1].blockType!=b;)e++;if(h==e)c.children.push(this.CreateBlock().CopyFrom(a[d]));else{d=false;g=this.m_Markdown.GetStringBuilder();for(h=h;h<=e;h++){var i=a[h];g.Append(i.buf.substr(i.contentStart,i.contentLen));g.Append("\n");if(a[h].blockType==k)d=true}h=this.CreateBlock();h.blockType=19;i=new r(this.m_Markdown);i.m_parentType=b;h.children=i.Process(g.ToString());if(!d)for(d=0;d<h.children.length;d++){g=h.children[d];if(g.blockType==m)g.blockType=17}c.children.push(h)}d=e}this.FreeBlocks(a);
a.length=0;return c};f.BuildDefinition=function(a){for(var b=1;b<a.length;b++)if(a[b].blockType==m&&(a[b-1].blockType==m||a[b-1].blockType==25)){a[b-1].set_contentEnd(a[b].get_contentEnd());this.FreeBlock(a[b]);a.splice(b,1);b--}var c=a[0].data;if(a.length==1&&!c){c=a[0];a.length=0;return c}c=this.m_Markdown.GetStringBuilder();for(b=0;b<a.length;b++){var d=a[b];c.Append(d.buf.substr(d.contentStart,d.contentLen));c.Append("\n")}b=this.CreateBlock();b.blockType=25;d=new r(this.m_Markdown);d.m_parentType=
25;b.children=d.Process(c.ToString());this.FreeBlocks(a);a.length=0;return b};f.BuildDefinitionLists=function(a){for(var b=null,c=0;c<a.length;c++)switch(a[c].blockType){case 26:case 25:if(b==null){b=this.CreateBlock();b.blockType=27;b.children=[];a.splice(c,0,b);c++}b.children.push(a[c]);a.splice(c,1);c--;break;default:b=null;break}};f.BuildFootnote=function(a){for(var b=1;b<a.length;b++)if(a[b].blockType==m&&(a[b-1].blockType==m||a[b-1].blockType==28)){a[b-1].set_contentEnd(a[b].get_contentEnd());
this.FreeBlock(a[b]);a.splice(b,1);b--}var c=this.m_Markdown.GetStringBuilder();for(b=0;b<a.length;b++){var d=a[b];c.Append(d.buf.substr(d.contentStart,d.contentLen));c.Append("\n")}b=new r(this.m_Markdown);b.m_parentType=28;d=this.CreateBlock();d.blockType=28;d.data=a[0].data;d.children=b.Process(c.ToString());this.FreeBlocks(a);a.length=0;return d};f.ProcessFencedCodeBlock=function(a,b){for(a.Mark();a.current()=="~";)a.SkipForward(1);var c=a.Extract();if(c.length<3)return false;a.SkipLinespace();
if(!a.eol())return false;a.SkipEol();var d=a.m_position;if(!a.Find(c))return false;if(!E(a.CharAtOffset(-1)))return false;var e=a.m_position;a.SkipForward(c.length);a.SkipLinespace();if(!a.eol())return false;b.blockType=18;b.children=[];e--;c=this.CreateBlock();c.blockType=13;c.buf=a.buf;c.contentStart=d;c.contentLen=e-d;b.children.push(c);return true};var $=0,S=1,T=2,R=3;f=K.prototype;f.LeadingBar=false;f.TrailingBar=false;f.ParseRow=function(a){a.SkipLinespace();if(a.eol())return null;var b=this.LeadingBar;
if(this.LeadingBar&&!a.SkipChar("|"))return null;for(var c=[];!a.eol();){for(a.Mark();!a.eol()&&a.current()!="|";)a.SkipForward(1);c.push(t(a.Extract()));b|=a.SkipChar("|")}if(!b)return null;for(;c.length<this.m_Columns.length;)c.push("&nbsp;");a.SkipEol();return c};f.RenderRow=function(a,b,c,d){for(var e=0;e<c.length;e++){b.Append("\t<");b.Append(d);if(e<this.m_Columns.length)switch(this.m_Columns[e]){case S:b.Append(' align="left"');break;case T:b.Append(' align="right"');break;case R:b.Append(' align="center"');
break}b.Append(">");a.m_SpanFormatter.Format2(b,c[e]);b.Append("</");b.Append(d);b.Append(">\n")}};f.Render=function(a,b){b.Append("<table>\n");if(this.m_Headers!=null){b.Append("<thead>\n<tr>\n");this.RenderRow(a,b,this.m_Headers,"th");b.Append("</tr>\n</thead>\n")}b.Append("<tbody>\n");for(var c=0;c<this.m_Rows.length;c++){var d=this.m_Rows[c];b.Append("<tr>\n");this.RenderRow(a,b,d,"td");b.Append("</tr>\n")}b.Append("</tbody>\n");b.Append("</table>\n")};this.Markdown=p});
