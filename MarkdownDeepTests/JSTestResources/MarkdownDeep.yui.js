var MarkdownDeep=new function(){function aS(p,n){if(p.indexOf!==undefined){return p.indexOf(n)}for(var b=0;b<p.length;b++){if(p[b]===n){return b}}return -1}function X(){this.m_SpanFormatter=new d(this);this.m_SpareBlocks=new Array();this.m_StringBuilder=new av();this.m_StringBuilderFinal=new av()}X.prototype={SafeMode:false,ExtraMode:false,MarkdownInHtml:false,AutoHeadingIDs:false,UrlBaseLocation:null,NewWindowForExternalLinks:false,NewWindowForLocalLinks:false,NoFollowLinks:false,HtmlClassFootnotes:"footnotes",HtmlClassTitledImages:null};var T=X.prototype;X.prototype.Transform=function(bc){var n=this.ProcessBlocks(bc);if(this.m_Abbreviations!=null){var a8=new Array();for(var bd in this.m_Abbreviations){a8.push(this.m_Abbreviations[bd])}a8.sort(function(be,i){return i.Abbr.length-be.Abbr.length});this.m_Abbreviations=a8}var a9=this.m_StringBuilderFinal;a9.Clear();for(var a7=0;a7<n.length;a7++){var bb=n[a7];bb.Render(this,a9)}if(this.m_UsedFootnotes.length>0){a9.Append('\n<div class="');a9.Append(this.HtmlClassFootnotes);a9.Append('">\n');a9.Append("<hr />\n");a9.Append("<ol>\n");for(var a7=0;a7<this.m_UsedFootnotes.length;a7++){var ba=this.m_UsedFootnotes[a7];a9.Append('<li id="#fn:');a9.Append(ba.data);a9.Append('">\n');var s='<a href="#fnref:'+ba.data+'" rev="footnote">&#8617;</a>';var p=ba.children[ba.children.length-1];if(p.blockType==J){p.blockType=aw;p.data=s}else{p=new C();p.contentLen=0;p.blockType=aw;p.data=s;ba.children.push(p)}ba.Render(this,a9);a9.Append("</li>\n")}a9.Append("</ol\n");a9.Append("</div>\n")}return a9.ToString()};X.prototype.OnQualifyUrl=function(b){if(!this.UrlBaseLocation){return b}if(aR(b)){return b}if(v(b,"/")){var n=this.UrlBaseLocation.indexOf("://");if(n==-1){n=0}else{n+=3}n=this.UrlBaseLocation.indexOf("/",n);var i=n<0?this.UrlBaseLocation:this.UrlBaseLocation.substr(0,n);return i+b}else{if(!A(this.UrlBaseLocation,"/")){return this.UrlBaseLocation+"/"+b}else{return this.UrlBaseLocation+b}}};X.prototype.OnGetImageSize=function(b){return null};X.prototype.OnPrepareLink=function(b){var i=b.m_attributes.href;if(this.NoFollowLinks){b.m_attributes.rel="nofollow"}if((this.NewWindowForExternalLinks&&aR(i))||(this.NewWindowForLocalLinks&&!aR(i))){b.m_attributes.target="_blank"}b.m_attributes.href=this.OnQualifyUrl(i)};X.prototype.OnPrepareImage=function(b){var i=this.OnGetImageSize(b.m_attributes.src);if(i!=null){b.m_attributes.width=i.width;b.m_attributes.height=i.height}b.m_attributes.src=this.OnQualifyUrl(b.m_attributes.src)};T.ProcessBlocks=function(i){var b=i.indexOf("\r");if(b>=0){var n=i.indexOf("\n");if(n>=0){if(n<b){i=i.replace(/\n\r/g,"\n")}else{i=i.replace(/\r\n/g,"\n")}}i=i.replace(/\r/g,"\n")}this.m_LinkDefinitions=new Array();this.m_Footnotes=new Array();this.m_UsedFootnotes=new Array();this.m_UsedHeaderIDs=new Array();this.m_Abbreviations=null;return new z(this,this.MarkdownInHtml).Process(i)};T.AddLinkDefinition=function(b){this.m_LinkDefinitions[b.id]=b};T.GetLinkDefinition=function(i){var b=this.m_LinkDefinitions[i];if(b==undefined){return null}else{return b}};T.AddFootnote=function(b){this.m_Footnotes[b.data]=b};T.ClaimFootnote=function(i){var b=this.m_Footnotes[i];if(b!=undefined){this.m_UsedFootnotes.push(b);delete this.m_Footnotes[i];return this.m_UsedFootnotes.length-1}else{return -1}};T.AddAbbreviation=function(b,i){if(this.m_Abbreviations==null){this.m_Abbreviations=new Array()}this.m_Abbreviations[b]={Abbr:b,Title:i}};T.GetAbbreviations=function(){return this.m_Abbreviations};T.MakeUniqueHeaderID=function(n,b,s){if(!this.AutoHeadingIDs){return null}var a7=this.m_SpanFormatter.MakeID(n,b,s);if(!a7){a7="section"}var p=a7;var i=1;while(this.m_UsedHeaderIDs[p]!=undefined){p=a7+"-"+i.toString();i++}this.m_UsedHeaderIDs[p]=true;return p};T.GetStringBuilder=function(){this.m_StringBuilder.Clear();return this.m_StringBuilder};function D(b){return b>="0"&&b<="9"}function a0(b){return(b>="0"&&b<="9")||(b>="a"&&b<="f")||(b>="A"&&b<="F")}function aY(b){return(b>="a"&&b<="z")||(b>="A"&&b<="Z")}function x(b){return(b>="a"&&b<="z")||(b>="A"&&b<="Z")||(b>="0"&&b<="9")}function aL(b){return(b==" "||b=="\t"||b=="\r"||b=="\n")}function q(b){return(b==" "||b=="\t")}function B(b){return(b=="\r"||b=="\n")}function at(b){return(b=="*"||b=="_")}function ap(b,i){switch(b){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case">":case"#":case"+":case"-":case".":case"!":return true;case":":case"|":case"=":case"<":return i}return false}function y(n,p){if(n.charAt(p)!="&"){return -1}var i=p;p++;var b;if(n.charAt(p)=="#"){p++;if(n.charAt(p)=="x"||n.charAt(p)=="X"){p++;b=a0}else{b=D}}else{b=x}if(b(n.charAt(p))){p++;while(b(n.charAt(p))){p++}if(n.charAt(p)==";"){p++;return p}}p=i;return -1}function ag(a7,s){var n=a7.indexOf("\\");if(n<0){return a7}var i=new av();var p=0;while(n>=0){if(ap(a7.charAt(n+1),s)){if(n>p){i.Append(a7.substr(p,n-p))}p=n+1}n=a7.indexOf("\\",n+1)}if(p<a7.length){i.Append(a7.substr(p,a7.length-p))}return i.ToString()}function a(p){var n=0;var b=p.length;while(n<b&&aL(p.charAt(n))){n++}while(b-1>n&&aL(p.charAt(b-1))){b--}return p.substr(n,b-n)}function aQ(n){var b=n.indexOf("@");if(b<0){return false}var i=n.lastIndexOf(".");if(i<b){return false}return true}function aC(b){b=b.toLowerCase();if(b.substr(0,7)=="http://"){return true}if(b.substr(0,8)=="https://"){return true}if(b.substr(0,6)=="ftp://"){return true}if(b.substr(0,7)=="file://"){return true}return false}function R(p){if(!p){return false}if(!aY(p.charAt(0))){return false}for(var b=0;b<p.length;b++){var n=p.charAt(b);if(x(n)||n=="_"||n=="-"||n==":"||n=="."){continue}return false}return true}function w(s,a8,i){var a7=i-1;while(a7>=a8&&aL(s.charAt(a7))){a7--}if(a7<a8||s.charAt(a7)!="}"){return null}var p=a7;a7--;while(a7>=a8&&s.charAt(a7)!="{"){a7--}if(a7<a8||s.charAt(a7+1)!="#"){return null}var b=a7+2;var n=s.substr(b,p-b);if(!R(n)){return null}while(a7>a8&&aL(s.charAt(a7-1))){a7--}return{id:n,end:a7}}function v(i,b){return i.substr(0,b.length)==b}function A(i,b){return i.substr(-b.length)==b}function aR(b){return b.indexOf("://")>=0||v(b,"mailto:")}function av(){this.m_content=new Array()}T=av.prototype;T.Append=function(b){if(b){this.m_content.push(b)}};T.Clear=function(){this.m_content.length=0};T.ToString=function(){return this.m_content.join("")};T.HtmlRandomize=function(p){var n=p.length;for(var s=0;s<n;s++){var b=Math.random();if(b>0.9&&p.charAt(s)!="@"){this.Append(p.charAt(s))}else{if(b>0.45){this.Append("&#");this.Append(p.charCodeAt(s).toString());this.Append(";")}else{this.Append("&#x");this.Append(p.charCodeAt(s).toString(16));this.Append(";")}}}};T.HtmlEncode=function(a8,b,a7){var n=b+a7;var s=b;for(var p=b;p<n;p++){switch(a8.charAt(p)){case"&":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&amp;");s=p+1;break;case"<":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&quot;");s=p+1;break}}if(p>s){this.Append(a8.substr(s,p-s))}};T.SmartHtmlEncodeAmpsAndAngles=function(a9,b,a7){var n=b+a7;var s=b;for(var p=b;p<n;p++){switch(a9.charAt(p)){case"&":var a8=y(a9,p);if(a8<0){if(p>s){this.Append(a9.substr(s,p-s))}this.Append("&amp;");s=p+1}else{p=a8-1}break;case"<":if(p>s){this.Append(a9.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(a9.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(a9.substr(s,p-s))}this.Append("&quot;");s=p+1;break}}if(p>s){this.Append(a9.substr(s,p-s))}};T.SmartHtmlEncodeAmps=function(a9,b,a7){var n=b+a7;var s=b;for(var p=b;p<n;p++){switch(a9.charAt(p)){case"&":var a8=y(a9,p);if(a8<0){if(p>s){this.Append(a9.substr(s,p-s))}this.Append("&amp;");s=p+1}else{p=a8-1}break}}if(p>s){this.Append(a9.substr(s,p-s))}};T.HtmlEncodeAndConvertTabsToSpaces=function(a8,b,a7){var n=b+a7;var s=b;var a9=0;for(var p=b;p<n;p++){switch(a8.charAt(p)){case"\t":if(p>s){this.Append(a8.substr(s,p-s))}s=p+1;this.Append(" ");a9++;while((a9%4)!=0){this.Append(" ");a9++}a9--;break;case"\r":case"\n":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("\n");s=p+1;continue;case"&":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&amp;");s=p+1;break;case"<":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(a8.substr(s,p-s))}this.Append("&quot;");s=p+1;break}a9++}if(p>s){this.Append(a8.substr(s,p-s))}};function c(){this.reset.apply(this,arguments)}T=c.prototype;T.bof=function(){return this.m_position==this.start};T.eof=function(){return this.m_position>=this.end};T.eol=function(){if(this.m_position>=this.end){return true}var b=this.buf.charAt(this.m_position);return b=="\r"||b=="\n"||b==undefined||b==""};T.reset=function(){this.buf=arguments.length>0?arguments[0]:null;this.start=arguments.length>1?arguments[1]:0;this.end=arguments.length>2?this.start+arguments[2]:(this.buf==null?0:this.buf.length);this.m_position=this.start;this.charset_offsets={}};T.current=function(){if(this.m_position>=this.end){return"\0"}return this.buf.charAt(this.m_position)};T.remainder=function(){return this.buf.substr(this.m_position)};T.SkipToEof=function(){this.m_position=this.end};T.SkipForward=function(b){this.m_position+=b};T.SkipToEol=function(){this.m_position=this.buf.indexOf("\n",this.m_position);if(this.m_position<0){this.m_position=this.end}};T.SkipEol=function(){var b=this.m_position;if(this.buf.charAt(this.m_position)=="\r"){this.m_position++}if(this.buf.charAt(this.m_position)=="\n"){this.m_position++}return this.m_position!=b};T.SkipToNextLine=function(){this.SkipToEol();this.SkipEol()};T.CharAtOffset=function(b){if(this.m_position+b>=this.end){return"\0"}return this.buf.charAt(this.m_position+b)};T.SkipChar=function(b){if(this.buf.charAt(this.m_position)==b){this.m_position++;return true}return false};T.SkipString=function(b){if(this.buf.substr(this.m_position,b.length)==b){this.m_position+=b.length;return true}return false};T.SkipWhitespace=function(){var i=this.m_position;while(true){var b=this.buf.charAt(this.m_position);if(b!=" "&&b!="\t"&&b!="\r"&&b!="\n"){break}this.m_position++}return this.m_position!=i};T.SkipLinespace=function(){var i=this.m_position;while(true){var b=this.buf.charAt(this.m_position);if(b!=" "&&b!="\t"){break}this.m_position++}return this.m_position!=i};T.FindRE=function(i){i.lastIndex=this.m_position;var b=i.exec(this.buf);if(b==null){this.m_position=this.end;return false}if(b.index+b[0].length>this.end){this.m_position=this.end;return false}this.m_position=b.index;return true};T.FindOneOf=function(p){var i=-1;for(var b in p){var n=p[b];if(n==null){n={};n.m_searched_from=-1;n.m_found_at=-1;p[b]=n}if(n.m_searched_from==-1||this.m_position<n.m_searched_from||(this.m_position>=n.m_found_at&&n.m_found_at!=-1)){n.m_searched_from=this.m_position;n.m_found_at=this.buf.indexOf(b,this.m_position)}if(i==-1||n.m_found_at<i){i=n.m_found_at}}if(i==-1){i=this.end;return false}T.m_position=i;return true};T.Find=function(b){this.m_position=this.buf.indexOf(b,this.m_position);if(this.m_position<0){this.m_position=this.end;return false}return true};T.Mark=function(){this.mark=this.m_position};T.Extract=function(){if(this.mark>=this.m_position){return""}else{return this.buf.substr(this.mark,this.m_position-this.mark)}};T.SkipIdentifier=function(){var b=this.buf.charAt(this.m_position);if((b>="a"&&b<="z")||(b>="A"&&b<="Z")||b=="_"){this.m_position++;while(true){var b=this.buf.charAt(this.m_position);if((b>="a"&&b<="z")||(b>="A"&&b<="Z")||b=="_"||(b>="0"&&b<="9")){this.m_position++}else{return true}}}return false};T.SkipFootnoteID=function(){var i=this.m_position;this.SkipLinespace();this.Mark();while(true){var b=this.current();if(x(b)||b=="-"||b=="_"||b==":"||b=="."||b==" "){this.SkipForward(1)}else{break}}if(this.m_position>this.mark){var n=a(this.Extract());if(n.length>0){this.SkipLinespace();return n}}this.m_position=i;return null};T.SkipHtmlEntity=function(){if(this.buf.charAt(this.m_position)!="&"){return false}var b=y(this.buf,this.m_position);if(b<0){return false}this.m_position=b;return true};T.SkipEscapableChar=function(b){if(this.buf.charAt(this.m_position)=="\\"&&ap(this.buf.charAt(this.m_position+1),b)){this.m_position+=2;return true}else{if(this.m_position<this.end){this.m_position++}return false}};var au=1;var a6=2;var aW=4;var ax=8;function ar(b){this.m_name=b;this.m_attributes={};this.m_flags=0}T=ar.prototype;T.m_attributes=null;T.closed=false;T.closing=false;T.attributeCount=function(){if(!this.m_attributes){return 0}var i=0;for(var b in this.m_attributes){i++}return i};T.get_Flags=function(){if(this.m_flags==0){this.m_flags=N[this.m_name.toLowerCase()];if(this.m_flags==undefined){this.m_flags=a6}}return this.m_flags};T.IsSafe=function(){var b=this.m_name.toLowerCase();if(!aZ[b]){return false}var p=am[b];if(!p){return this.attributeCount()==0}if(!this.m_attributes){return true}for(var n in this.m_attributes){if(!p[n.toLowerCase()]){return false}}if(this.m_attributes.href){if(!aX(this.m_attributes.href)){return false}}if(this.m_attributes.src){if(!aX(this.m_attributes.src)){return false}}return true};T.RenderOpening=function(b){b.Append("<");b.Append(this.m_name);for(var n in this.m_attributes){b.Append(" ");b.Append(n);b.Append('="');b.Append(this.m_attributes[n]);b.Append('"')}if(this.closed){b.Append(" />")}else{b.Append(">")}};T.RenderClosing=function(b){b.Append("</");b.Append(this.m_name);b.Append(">")};function aX(b){b=b.toLowerCase();return(b.substr(0,7)=="http://"||b.substr(0,8)=="https://"||b.substr(0,6)=="ftp://")}function O(n){var i=n.m_position;var b=W(n);if(b!=null){return b}n.m_position=i;return null}function W(a7){if(a7.current()!="<"){return null}a7.SkipForward(1);if(a7.SkipString("!--")){a7.Mark();if(a7.Find("-->")){var n=new ar("!");n.m_attributes.content=a7.Extract();n.closed=true;a7.SkipForward(3);return n}}var s=a7.SkipChar("/");a7.Mark();if(!a7.SkipIdentifier()){return null}var b=new ar(a7.Extract());b.closing=s;if(s){if(a7.current()!=">"){return null}a7.SkipForward(1);return b}while(!a7.eof()){a7.SkipWhitespace();if(a7.SkipString("/>")){b.closed=true;return b}if(a7.SkipChar(">")){return b}a7.Mark();if(!a7.SkipIdentifier()){return null}var i=a7.Extract();a7.SkipWhitespace();if(!a7.SkipChar("=")){return null}a7.SkipWhitespace();if(a7.SkipChar('"')){a7.Mark();if(!a7.Find('"')){return null}b.m_attributes[i]=a7.Extract();a7.SkipForward(1)}else{a7.Mark();while(!a7.eof()&&!aL(a7.current())&&a7.current()!=">"&&a7.current()!="/"){a7.SkipForward(1)}if(!a7.eof()){b.m_attributes[i]=a7.Extract()}}}return null}var aZ={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1};var am={a:{href:1,title:1},img:{src:1,width:1,height:1,alt:1,title:1}};var af=au;var Z=a6;var U=aW;var Q=ax;var N={p:af|Q,div:af,h1:af|Q,h2:af|Q,h3:af|Q,h4:af|Q,h5:af|Q,h6:af|Q,blockquote:af,pre:af,table:af,dl:af,ol:af,ul:af,form:af,fieldset:af,iframe:af,script:af|Z,noscript:af|Z,math:af|Z,ins:af|Z,del:af|Z,img:af|Z,li:Q,dd:Q,dt:Q,td:Q,th:Q,legend:Q,address:Q,hr:af|U,"!":af|U};delete af;delete Z;delete U;function u(n,b,i){this.id=n;this.url=b;if(i==undefined){this.title=null}else{this.title=i}}T=u.prototype;T.RenderLink=function(p,n,s){if(this.url.substr(0,7).toLowerCase()=="mailto:"){n.Append('<a href="');n.HtmlRandomize(this.url);n.Append('"');if(this.title){n.Append(' title="');n.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);n.Append('"')}n.Append(">");n.HtmlRandomize(s);n.Append("</a>")}else{var i=new ar("a");var a7=p.GetStringBuilder();a7.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);i.m_attributes.href=a7.ToString();if(this.title){a7.Clear();a7.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);i.m_attributes.title=a7.ToString()}p.OnPrepareLink(i);i.RenderOpening(n);n.Append(s);n.Append("</a>")}};T.RenderImg=function(p,n,s){var i=new ar("img");var a7=p.GetStringBuilder();a7.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);i.m_attributes.src=a7.ToString();if(s){a7.Clear();a7.SmartHtmlEncodeAmpsAndAngles(s,0,s.length);i.m_attributes.alt=a7.ToString()}if(this.title){a7.Clear();a7.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);i.m_attributes.title=a7.ToString()}i.closed=true;p.OnPrepareImage(i);i.RenderOpening(n)};function a4(s,n){var i=s.m_position;var b=az(s,n);if(b==null){s.m_position=i}return b}function az(n,i){n.SkipWhitespace();if(!n.SkipChar("[")){return null}n.Mark();if(!n.Find("]")){return null}var s=n.Extract();if(s.length==0){return null}if(!n.SkipString("]:")){return null}var b=Y(n,s,i);n.SkipLinespace();if(!n.eol()){return null}return b}function Y(a8,a7,bc){a8.SkipWhitespace();if(a8.eol()){return null}var b=new u(a7);if(a8.SkipChar("<")){a8.Mark();while(a8.current()!=">"){if(a8.eof()){return null}a8.SkipEscapableChar(bc)}var s=a8.Extract();if(!a8.SkipChar(">")){return null}b.url=ag(a(s),bc);a8.SkipWhitespace()}else{a8.Mark();var n=1;while(!a8.eol()){var i=a8.current();if(aL(i)){break}if(a7==null){if(i=="("){n++}else{if(i==")"){n--;if(n==0){break}}}}a8.SkipEscapableChar(bc)}b.url=ag(a(a8.Extract()),bc)}a8.SkipLinespace();if(a8.current()==")"){return b}var bd=a8.eol();var bb=a8.m_position;if(a8.eol()){a8.SkipEol();a8.SkipLinespace()}var ba;switch(a8.current()){case"'":case'"':ba=a8.current();break;case"(":ba=")";break;default:if(bd){a8.m_position=bb;return b}else{return null}}a8.SkipForward(1);a8.Mark();while(true){if(a8.eol()){return null}if(a8.current()==ba){if(ba!=")"){var a9=a8.m_position;a8.SkipForward(1);a8.SkipLinespace();if((a7==null&&a8.current()!=")")||(a7!=null&&!a8.eol())){continue}a8.m_position=a9}break}a8.SkipEscapableChar(bc)}b.title=ag(a8.Extract(),bc);a8.SkipForward(1);return b}function h(i,b){this.def=i;this.link_text=b}var E=0;var m=1;var I=2;var f=3;var a3=4;var M=5;var a5=6;var V=7;var g=8;var ab=9;var ai=10;var aB=11;var a2=12;var aV=13;var a1=14;var t=15;function aJ(i,b,n){this.type=i;this.startOffset=b;this.length=n;this.data=null}function d(b){this.m_Markdown=b;this.m_Scanner=new c();this.m_SpareTokens=new Array();this.m_DisableLinks=false;this.m_Tokens=new Array()}T=d.prototype;T.FormatParagraph=function(n,p,s,i){this.Tokenize(p,s,i);if(this.m_Tokens.length==1&&this.m_Markdown.HtmlClassTitledImages!=null&&this.m_Tokens[0].type==ai){var b=this.m_Tokens[0].data;n.Append('<div class="');n.Append(this.m_Markdown.HtmlClassTitledImages);n.Append('">\n');this.Render(n,p);n.Append("\n");if(b.def.title){n.Append("<p>");n.SmartHtmlEncodeAmpsAndAngles(b.def.title,0,b.def.title.length);n.Append("</p>\n")}n.Append("</div>\n")}else{n.Append("<p>");this.Render(n,p);n.Append("</p>\n")}};T.Format2=function(b,i){this.Format(b,i,0,i.length)};T.Format=function(i,n,p,b){this.Tokenize(n,p,b);this.Render(i,n)};T.FormatDirect=function(i){var b=new av();this.Format(b,i,0,i.length);return b.ToString()};T.MakeID=function(a9,n,a8){this.Tokenize(a9,n,a8);var ba=this.m_Tokens;var bb=new av();for(var a7=0;a7<ba.length;a7++){var bc=ba[a7];switch(bc.type){case E:bb.Append(a9.substr(bc.startOffset,bc.length));break;case ab:bb.Append(bc.data.link_text);break}this.FreeToken(bc)}var s=this.m_Scanner;s.reset(bb.ToString());while(!s.eof()){if(aY(s.current())){break}s.SkipForward(1)}bb.Clear();while(!s.eof()){var b=s.current();if(x(b)||b=="_"||b=="-"||b=="."){bb.Append(b.toLowerCase())}else{if(b==" "){bb.Append("-")}else{if(B(b)){bb.Append("-");s.SkipEol();continue}}}s.SkipForward(1)}return bb.ToString()};T.Render=function(a9,a7){var a8=this.m_Tokens;var s=a8.length;for(var n=0;n<s;n++){var bc=a8[n];switch(bc.type){case E:a9.HtmlEncode(a7,bc.startOffset,bc.length);break;case m:a9.SmartHtmlEncodeAmps(a7,bc.startOffset,bc.length);break;case I:case aB:case a2:case aV:a9.Append(a7.substr(bc.startOffset,bc.length));break;case g:a9.Append("<br />\n");break;case f:a9.Append("<em>");break;case a3:a9.Append("</em>");break;case M:a9.Append("<strong>");break;case a5:a9.Append("</strong>");break;case V:a9.Append("<code>");a9.HtmlEncode(a7,bc.startOffset,bc.length);a9.Append("</code>");break;case ab:var bb=bc.data;var p=new d(this.m_Markdown);p.m_DisableLinks=true;bb.def.RenderLink(this.m_Markdown,a9,p.FormatDirect(bb.link_text));break;case ai:var bb=bc.data;bb.def.RenderImg(this.m_Markdown,a9,bb.link_text);break;case a1:var b=bc.data;a9.Append('<sup id="fnref:');a9.Append(b.id);a9.Append('"><a href="#fn:');a9.Append(b.id);a9.Append('" rel="footnote">');a9.Append(b.index+1);a9.Append("</a></sup>");break;case t:var ba=bc.data;a9.Append("<abbr");if(ba.Title){a9.Append(' title="');a9.HtmlEncode(ba.Title,0,ba.Title.length);a9.Append('"')}a9.Append(">");a9.HtmlEncode(ba.Abbr,0,ba.Abbr.length);a9.Append("</abbr>");break}this.FreeToken(bc)}};T.Tokenize=function(bh,a8,bj){var bf=this.m_Scanner;bf.reset(bh,a8,bj);var bc=this.m_Tokens;bc.length=0;var s=null;var be=this.m_Markdown.GetAbbreviations();var bg=be==null?/[\*\_\`\[\!\<\&\ \\]/g:null;var a9=this.m_Markdown.ExtraMode;var b=bf.m_position;while(!bf.eof()){if(bg!=null&&!bf.FindRE(bg)){break}var a7=bf.m_position;var ba=null;switch(bf.current()){case"*":case"_":ba=this.CreateEmphasisMark();if(ba!=null){switch(ba.type){case aV:case aB:case a2:if(s==null){s=new Array()}s.push(ba);break}}break;case"`":ba=this.ProcessCodeSpan();break;case"[":case"!":var bb=bf.m_position;ba=this.ProcessLinkOrImageOrFootnote();if(ba==null){bf.m_position=bb}break;case"<":var bk=bf.m_position;var bl=O(bf);if(bl!=null){if(!this.m_Markdown.SafeMode||bl.IsSafe()){ba=this.CreateToken(m,bk,bf.m_position-bk)}else{bf.m_position=bk}}else{bf.m_position=bk;ba=this.ProcessAutoLink();if(ba==null){bf.m_position=bk}}break;case"&":var bk=bf.m_position;if(bf.SkipHtmlEntity()){ba=this.CreateToken(I,bk,bf.m_position-bk)}break;case" ":if(bf.CharAtOffset(1)==" "&&B(bf.CharAtOffset(2))){bf.SkipForward(2);if(!bf.eof()){bf.SkipEol();ba=this.CreateToken(g,a7,0)}}break;case"\\":if(ap(bf.CharAtOffset(1),a9)){ba=this.CreateToken(E,bf.m_position+1,1);bf.SkipForward(2)}break}if(ba==null&&be!=null&&!x(bf.CharAtOffset(-1))){var n=bf.m_position;for(var bi in be){var bd=be[bi];if(bf.SkipString(bd.Abbr)&&!x(bf.current())){ba=this.CreateDataToken(t,bd);break}bf.position=n}}if(ba!=null){if(a7>b){bc.push(this.CreateToken(E,b,a7-b))}bc.push(ba);b=bf.m_position}else{bf.SkipForward(1)}}if(bf.m_position>b){bc.push(this.CreateToken(E,b,bf.m_position-b))}if(s!=null){this.ResolveEmphasisMarks(bc,s)}};T.CreateEmphasisMark=function(){var a9=this.m_Scanner;var n=a9.current();var a8=n=="*"?"_":"*";var a7=a9.m_position;if(a9.bof()||aL(a9.CharAtOffset(-1))){while(at(a9.current())){a9.SkipForward(1)}if(a9.eof()||aL(a9.current())){return this.CreateToken(I,a7,a9.m_position-a7)}a9.m_position=a7}while(at(a9.CharAtOffset(-1))){a9.SkipForward(-1)}var b=a9.bof()||aL(a9.CharAtOffset(-1));a9.m_position=a7;while(a9.current()==n){a9.SkipForward(1)}var s=a9.m_position-a7;while(at(a9.CharAtOffset(1))){a9.SkipForward(1)}var i=a9.eof()||aL(a9.current());a9.m_position=a7+s;if(b){return this.CreateToken(aB,a7,a9.m_position-a7)}if(i){return this.CreateToken(a2,a7,a9.m_position-a7)}if(this.m_Markdown.ExtraMode&&n=="_"){return null}return this.CreateToken(aV,a7,a9.m_position-a7)};T.SplitMarkToken=function(s,n,i,b){var p=this.CreateToken(i.type,i.startOffset+b,i.length-b);i.length=b;n.splice(aS(n,i)+1,0,p);s.splice(aS(s,i)+1,0,p);return p};T.ResolveEmphasisMarks=function(a8,ba){var bb=this.m_Scanner.buf;var a9=true;while(a9){a9=false;for(var s=0;s<ba.length;s++){var a7=ba[s];if(a7.type!=aB&&a7.type!=aV){continue}for(var p=s+1;p<ba.length;p++){var n=ba[p];if(n.type!=a2&&n.type!=aV){break}if(bb.charAt(a7.startOffset)!=bb.charAt(n.startOffset)){continue}var b=Math.min(a7.length,n.length);if(b>=3){b=(b%2)==1?1:2}if(a7.length>b){a7=this.SplitMarkToken(a8,ba,a7,a7.length-b);s--}if(n.length>b){this.SplitMarkToken(a8,ba,n,b)}a7.type=b==1?f:M;n.type=b==1?a3:a5;ba.splice(aS(ba,a7),1);ba.splice(aS(ba,n),1);a9=true;break}}}};T.ProcessAutoLink=function(){if(this.m_DisableLinks){return null}var a8=this.m_Scanner;a8.SkipForward(1);a8.Mark();var a7=this.m_Markdown.ExtraMode;while(!a8.eof()){var s=a8.current();if(aL(s)){break}if(s==">"){var n=ag(a8.Extract(),a7);var b=null;if(aQ(n)){var i;if(n.toLowerCase().substr(0,7)=="mailto:"){i=n.substr(7)}else{i=n;n="mailto:"+n}b=new h(new u("auto",n,null),i)}else{if(aC(n)){b=new h(new u("auto",n,null),n)}}if(b!=null){a8.SkipForward(1);return this.CreateDataToken(ab,b)}return null}a8.SkipEscapableChar(a7)}return null};T.ProcessLinkOrImageOrFootnote=function(){var a8=this.m_Scanner;var bh=a8.SkipChar("!")?ai:ab;if(!a8.SkipChar("[")){return null}var ba=this.m_position;if(this.m_Markdown.ExtraMode&&bh==ab&&a8.SkipChar("^")){a8.SkipLinespace();a8.Mark();var a7=a8.SkipFootnoteID();if(a7!=null&&a8.SkipChar("]")){var bi=this.m_Markdown.ClaimFootnote(a7);if(bi>=0){return this.CreateDataToken(a1,{index:bi,id:a7})}}this.m_position=ba}if(this.m_DisableLinks){return null}var bg=this.m_Markdown.ExtraMode;a8.Mark();var bf=1;while(!a8.eof()){var b=a8.current();if(b=="["){bf++}else{if(b=="]"){bf--;if(bf==0){break}}}a8.SkipEscapableChar(bg)}if(a8.eof()){return null}var n=ag(a8.Extract(),bg);a8.SkipForward(1);var ba=a8.m_position;if(a8.SkipChar("(")){var bd=Y(a8,null,this.m_Markdown.ExtraMode);if(bd==null){return null}a8.SkipWhitespace();if(!a8.SkipChar(")")){return null}return this.CreateDataToken(bh,new h(bd,n))}if(!a8.SkipChar(" ")){a8.SkipChar("\t")}if(a8.eol()){a8.SkipEol();a8.SkipLinespace()}var bb=null;if(a8.current()=="["){a8.SkipForward(1);a8.Mark();if(!a8.Find("]")){return null}bb=a8.Extract();a8.SkipForward(1)}else{a8.m_position=ba}if(!bb){bb=n;while(true){var be=bb.indexOf("\n");if(be<0){break}var s=be;while(s>0&&aL(bb.charAt(s-1))){s--}var bc=be;while(bc<bb.length&&aL(bb.charAt(bc))){bc++}bb=bb.substr(0,s)+" "+bb.substr(bc)}}var a9=this.m_Markdown.GetLinkDefinition(bb);if(a9==null){return null}return this.CreateDataToken(bh,new h(a9,n))};T.ProcessCodeSpan=function(){var a7=this.m_Scanner;var a8=a7.m_position;var n=0;while(a7.SkipChar("`")){n++}a7.SkipWhitespace();if(a7.eof()){return this.CreateToken(E,a8,a7.m_position-a8)}var i=a7.m_position;if(!a7.Find(a7.buf.substr(a8,n))){return this.CreateToken(E,a8,a7.m_position-a8)}var s=a7.m_position+n;while(aL(a7.CharAtOffset(-1))){a7.SkipForward(-1)}var b=this.CreateToken(V,i,a7.m_position-i);a7.m_position=s;return b};T.CreateToken=function(n,b,p){if(this.m_SpareTokens.length!=0){var i=this.m_SpareTokens.pop();i.type=n;i.startOffset=b;i.length=p;i.data=null;return i}else{return new aJ(n,b,p)}};T.CreateDataToken=function(i,n){if(this.m_SpareTokens.length!=0){var b=this.m_SpareTokens.pop();b.type=i;b.data=n;return b}else{var b=new aJ(i,0,0);b.data=n;return b}};T.FreeToken=function(b){b.data=null;this.m_SpareTokens.push(b)};var an=0;var aI=1;var aH=2;var aG=3;var aF=4;var aE=5;var aD=6;var ac=7;var aa=8;var al=9;var ae=10;var L=11;var J=12;var aq=13;var P=14;var aN=15;var aT=16;var r=17;var aA=18;var aO=19;var G=20;var H=21;var ak=22;var l=23;var K=24;var o=25;var e=26;var k=27;var ad=28;var aw=29;function C(){}T=C.prototype;T.buf=null;T.blockType=an;T.contentStart=0;T.contentLen=0;T.lineStart=0;T.lineLen=0;T.children=null;T.data=null;T.get_Content=function(){if(this.buf==null){return null}if(this.contentStart==-1){return this.buf}return this.buf.substr(this.contentStart,this.contentLen)};T.get_CodeContent=function(){var n=new av();for(var b=0;b<this.children.length;b++){n.Append(this.children[b].get_Content());n.Append("\n")}return n.ToString()};T.RenderChildren=function(p,n){for(var s=0;s<this.children.length;s++){this.children[s].Render(p,n)}};T.ResolveHeaderID=function(b){if(this.data!=null){return this.data}var i=w(this.buf,this.contentStart,this.get_contentEnd());var n=null;if(i!=null){this.set_contentEnd(i.end);n=i.id}else{n=b.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen)}this.data=n;return n};T.Render=function(s,a9){switch(this.blockType){case an:return;case J:s.m_SpanFormatter.FormatParagraph(a9,this.buf,this.contentStart,this.contentLen);break;case r:s.m_SpanFormatter.Format(a9,this.buf,this.contentStart,this.contentLen);a9.Append("\n");break;case aI:case aH:case aG:case aF:case aE:case aD:if(s.ExtraMode&&!s.SafeMode){a9.Append("<h"+(this.blockType-aI+1).toString());var p=this.ResolveHeaderID(s);if(p){a9.Append(' id="');a9.Append(p);a9.Append('">')}else{a9.Append(">")}}else{a9.Append("<h"+(this.blockType-aI+1).toString()+">")}s.m_SpanFormatter.Format(a9,this.buf,this.contentStart,this.contentLen);a9.Append("</h"+(this.blockType-aI+1).toString()+">\n");break;case P:a9.Append("<hr />\n");return;case ae:case L:a9.Append("<li>");s.m_SpanFormatter.Format(a9,this.buf,this.contentStart,this.contentLen);a9.Append("</li>\n");break;case aN:a9.Append(this.buf.substr(this.contentStart,this.contentLen));return;case aT:a9.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case aA:a9.Append("<pre><code>");for(var a8=0;a8<this.children.length;a8++){var ba=this.children[a8];a9.HtmlEncodeAndConvertTabsToSpaces(ba.buf,ba.contentStart,ba.contentLen);a9.Append("\n")}a9.Append("</code></pre>\n\n");return;case al:a9.Append("<blockquote>\n");this.RenderChildren(s,a9);a9.Append("</blockquote>\n");return;case aO:a9.Append("<li>\n");this.RenderChildren(s,a9);a9.Append("</li>\n");return;case G:a9.Append("<ol>\n");this.RenderChildren(s,a9);a9.Append("</ol>\n");return;case H:a9.Append("<ul>\n");this.RenderChildren(s,a9);a9.Append("</ul>\n");return;case ak:var bc=this.data;var n=bc.m_name.toLowerCase();if(n=="a"){s.OnPrepareLink(bc)}else{if(n=="img"){s.OnPrepareImage(bc)}}bc.RenderOpening(a9);a9.Append("\n");this.RenderChildren(s,a9);bc.RenderClosing(a9);a9.Append("\n");return;case l:case ad:this.RenderChildren(s,a9);return;case K:this.data.Render(s,a9);return;case o:a9.Append("<dd>");if(this.children!=null){a9.Append("\n");this.RenderChildren(s,a9)}else{s.m_SpanFormatter.Format(a9,this.buf,this.contentStart,this.contentLen)}a9.Append("</dd>\n");break;case e:if(this.children==null){var bb=this.get_Content().split("\n");for(var a8=0;a8<bb.length;a8++){var a7=bb[a8];a9.Append("<dt>");s.m_SpanFormatter.Format2(a9,a(a7));a9.Append("</dt>\n")}}else{a9.Append("<dt>\n");this.RenderChildren(s,a9);a9.Append("</dt>\n")}break;case k:a9.Append("<dl>\n");this.RenderChildren(s,a9);a9.Append("</dl>\n");return;case aw:a9.Append("<p>");if(this.contentLen>0){s.m_SpanFormatter.Format(a9,this.buf,this.contentStart,this.contentLen);a9.Append("&nbsp;")}a9.Append(this.data);a9.Append("</p>\n");break}};T.RevertToPlain=function(){this.blockType=J;this.contentStart=this.lineStart;this.contentLen=this.lineLen};T.get_contentEnd=function(){return this.contentStart+this.contentLen};T.set_contentEnd=function(b){this.contentLen=b-this.contentStart};T.get_leadingSpaces=function(){var n=0;for(var b=this.lineStart;b<this.lineStart+this.lineLen;b++){if(this.buf.charAt(b)==" "){n++}else{break}}return n};T.CopyFrom=function(b){this.blockType=b.blockType;this.buf=b.buf;this.contentStart=b.contentStart;this.contentLen=b.contentLen;this.lineStart=b.lineStart;this.lineLen=b.lineLen;return this};function z(b,i){this.m_Markdown=b;this.m_parentType=an;this.m_bMarkdownInHtml=i}T=z.prototype;T.Process=function(i){var b=new c(i);return this.ScanLines(b)};T.ProcessRange=function(s,i,b){var n=new c(s,i,b);return this.ScanLines(n)};T.StartTable=function(s,i,b){if(b.length>1){return false}if(b.length==1){var n=s.m_position;s.m_position=b[0].lineStart;i.m_Headers=i.ParseRow(s);if(i.m_Headers==null){return false}s.m_position=n;b.length=0}while(true){var n=s.m_position;var a7=i.ParseRow(s);if(a7!=null){i.m_Rows.push(a7);continue}s.m_position=n;break}return true};T.ScanLines=function(n){var i=new Array();var bd=new Array();var a9=-1;while(!n.eof()){var a8=a9==an;var ba=this.EvaluateLine(n);a9=ba.blockType;if(ba.blockType==o){ba.data=a8}if(ba.blockType==ac||ba.blockType==aa){if(bd.length>0){var a7=bd.pop();this.CollapseLines(i,bd);if(a7.blockType!=an){a7.RevertToPlain();a7.blockType=ba.blockType==ac?aI:aH;i.push(a7);continue}}if(ba.blockType==ac){ba.RevertToPlain();bd.push(ba)}else{if(ba.contentLen>=3){ba.blockType=P;i.push(ba)}else{ba.RevertToPlain();bd.push(ba)}}continue}var bb=bd.length>0?bd[0].blockType:an;if(ba.blockType==K){var bc=ba.data;var s=n.m_position;if(!this.StartTable(n,bc,bd)){n.m_position=s;ba.RevertToPlain()}else{i.push(ba);continue}}switch(ba.blockType){case an:switch(bb){case an:this.FreeBlock(ba);break;case J:this.CollapseLines(i,bd);this.FreeBlock(ba);break;case al:case ae:case L:case o:case ad:case aq:bd.push(ba);break}break;case J:switch(bb){case an:case J:bd.push(ba);break;case al:case ae:case L:case o:case ad:var a7=bd[bd.length-1];if(a7.blockType==an){this.CollapseLines(i,bd);bd.push(ba)}else{bd.push(ba)}break;case aq:this.CollapseLines(i,bd);bd.push(ba);break}break;case aq:switch(bb){case an:bd.push(ba);break;case J:case al:var a7=bd[bd.length-1];if(a7.blockType==an){this.CollapseLines(i,bd);bd.push(ba)}else{ba.RevertToPlain();bd.push(ba)}break;case ae:case L:case aq:case o:case ad:bd.push(ba);break}break;case al:if(bb!=al){this.CollapseLines(i,bd)}bd.push(ba);break;case ae:case L:switch(bb){case an:bd.push(ba);break;case J:case al:var a7=bd[bd.length-1];if(a7.blockType==an||this.m_parentType==ae||this.m_parentType==L||this.m_parentType==o){this.CollapseLines(i,bd);bd.push(ba)}else{ba.RevertToPlain();bd.push(ba)}break;case ae:case L:case o:case ad:if(ba.blockType!=bb){this.CollapseLines(i,bd)}bd.push(ba);break;case aq:this.CollapseLines(i,bd);bd.push(ba);break}break;case o:case ad:switch(bb){case an:case J:case o:case ad:this.CollapseLines(i,bd);bd.push(ba);break;default:ba.RevertToPlain();bd.push(ba);break}break;default:this.CollapseLines(i,bd);i.push(ba);break}}this.CollapseLines(i,bd);if(this.m_Markdown.ExtraMode){this.BuildDefinitionLists(i)}return i};T.CreateBlock=function(){if(this.m_Markdown.m_SpareBlocks.length>1){return this.m_Markdown.m_SpareBlocks.pop()}else{return new C()}};T.FreeBlock=function(i){this.m_Markdown.m_SpareBlocks.push(i)};T.FreeBlocks=function(n){for(var b=0;b<n.length;b++){this.m_Markdown.m_SpareBlocks.push(n[b])}n.length=0};T.RenderLines=function(s){var n=this.m_Markdown.GetStringBuilder();for(var a7=0;a7<s.length;a7++){var p=s[a7];n.Append(p.buf.substr(p.contentStart,p.contentLen));n.Append("\n")}return n.ToString()};T.CollapseLines=function(b,bb){while(bb.length>0&&bb[bb.length-1].blockType==an){this.FreeBlock(bb.pop())}if(bb.length==0){return}switch(bb[0].blockType){case J:var bc=this.CreateBlock();bc.blockType=J;bc.buf=bb[0].buf;bc.contentStart=bb[0].contentStart;bc.set_contentEnd(bb[bb.length-1].get_contentEnd());b.push(bc);this.FreeBlocks(bb);break;case al:var ba=this.RenderLines(bb);var n=new z(this.m_Markdown,this.m_bMarkdownInHtml);n.m_parentType=al;var p=this.CreateBlock();p.blockType=al;p.children=n.Process(ba);this.FreeBlocks(bb);b.push(p);break;case ae:case L:b.push(this.BuildList(bb));break;case o:if(b.length>0){var a7=b[b.length-1];switch(a7.blockType){case J:a7.blockType=e;break;case o:break;default:var s=this.CreateBlock();s.blockType=e;s.children=new Array();s.children.push(a7);b.pop();b.push(s);break}}b.push(this.BuildDefinition(bb));break;case ad:this.m_Markdown.AddFootnote(this.BuildFootnote(bb));break;case aq:var a9=this.CreateBlock();a9.blockType=aA;a9.children=new Array();for(var a8=0;a8<bb.length;a8++){a9.children.push(bb[a8])}b.push(a9);bb.length=0;break}};T.EvaluateLine=function(n){var i=this.CreateBlock();i.lineStart=n.m_position;i.buf=n.buf;i.contentStart=n.m_position;i.contentLen=-1;i.blockType=this.EvaluateLineInternal(n,i);if(i.contentLen<0){n.SkipToEol();i.contentLen=n.m_position-i.contentStart}i.lineLen=n.m_position-i.lineStart;n.SkipEol();return i};T.EvaluateLineInternal=function(a7,bg){if(a7.eol()){return an}var ba=a7.m_position;var i=a7.current();if(i=="#"){var n=1;a7.SkipForward(1);while(a7.current()=="#"){n++;a7.SkipForward(1)}if(n>6){n=6}a7.SkipLinespace();bg.contentStart=a7.m_position;a7.SkipToEol();if(this.m_Markdown.ExtraMode&&!this.m_Markdown.SafeMode){var bf=w(a7.buf,bg.contentStart,a7.m_position);if(bf!=null){bg.data=bf.id;a7.m_position=bf.end}}while(a7.m_position>bg.contentStart&&a7.CharAtOffset(-1)=="#"){a7.SkipForward(-1)}while(a7.m_position>bg.contentStart&&aL(a7.CharAtOffset(-1))){a7.SkipForward(-1)}bg.contentLen=a7.m_position-bg.contentStart;a7.SkipToEol();return aI+(n-1)}if(i=="-"||i=="="){var bd=i;while(a7.current()==bd){a7.SkipForward(1)}a7.SkipLinespace();if(a7.eol()){return bd=="="?ac:aa}a7.m_position=ba}if(this.m_Markdown.ExtraMode){var bi=F(a7);if(bi!=null){bg.data=bi;return K}a7.m_position=ba;if(i=="~"){if(this.ProcessFencedCodeBlock(a7,bg)){return bg.blockType}a7.m_position=ba}}var bc=-1;var a9=0;while(!a7.eol()){if(a7.current()==" "){if(bc<0){a9++}}else{if(a7.current()=="\t"){if(bc<0){bc=a7.m_position}}else{break}}a7.SkipForward(1)}if(a7.eol()){bg.contentLen=0;return an}if(a9>=4){bg.contentStart=ba+4;return aq}if(bc>=0&&bc-ba<4){bg.contentStart=bc+1;return aq}bg.contentStart=a7.m_position;i=a7.current();if(i=="<"){if(this.ScanHtml(a7,bg)){return bg.blockType}a7.m_position=bg.contentStart}if(i==">"){if(q(a7.CharAtOffset(1))){a7.SkipForward(2);bg.contentStart=a7.m_position;return al}a7.SkipForward(1);bg.contentStart=a7.m_position;return al}if(i=="-"||i=="_"||i=="*"){var be=0;while(!a7.eol()){var bd=a7.current();if(a7.current()==i){be++;a7.SkipForward(1);continue}if(q(a7.current())){a7.SkipForward(1);continue}break}if(a7.eol()&&be>=3){return P}a7.m_position=bg.contentStart}if(this.m_Markdown.ExtraMode&&i=="*"&&a7.CharAtOffset(1)=="["){a7.SkipForward(2);a7.SkipLinespace();a7.Mark();while(!a7.eol()&&a7.current()!="]"){a7.SkipForward(1)}var bj=a(a7.Extract());if(a7.current()=="]"&&a7.CharAtOffset(1)==":"&&bj){a7.SkipForward(2);a7.SkipLinespace();a7.Mark();a7.SkipToEol();var bh=a7.Extract();this.m_Markdown.AddAbbreviation(bj,bh);return an}a7.m_position=bg.contentStart}if((i=="*"||i=="+"||i=="-")&&q(a7.CharAtOffset(1))){a7.SkipForward(1);a7.SkipLinespace();bg.contentStart=a7.m_position;return L}if(i==":"&&this.m_Markdown.ExtraMode&&q(a7.CharAtOffset(1))){a7.SkipForward(1);a7.SkipLinespace();bg.contentStart=a7.m_position;return o}if(D(i)){a7.SkipForward(1);while(D(a7.current())){a7.SkipForward(1)}if(a7.SkipChar(".")&&a7.SkipLinespace()){bg.contentStart=a7.m_position;return ae}a7.m_position=bg.contentStart}if(i=="["){if(this.m_Markdown.ExtraMode&&a7.CharAtOffset(1)=="^"){var a8=a7.m_position;a7.SkipForward(2);var s=a7.SkipFootnoteID();if(s!=null&&a7.SkipChar("]")&&a7.SkipChar(":")){a7.SkipLinespace();bg.contentStart=a7.m_position;bg.data=s;return ad}a7.m_position=a8}var bb=a4(a7,this.m_Markdown.ExtraMode);if(bb!=null){this.m_Markdown.AddLinkDefinition(bb);return an}}return J};var aK=0;var aP=1;var aM=2;var j=3;var ao=4;T.GetMarkdownMode=function(b){var i=b.m_attributes.markdown;if(i==undefined){if(this.m_bMarkdownInHtml){return j}else{return aK}}delete b.m_attributes.markdown;if(i=="1"){return(b.get_Flags()&ax)!=0?aM:aP}if(i=="block"){return aP}if(i=="deep"){return j}if(i=="span"){return aM}return ao};T.ProcessMarkdownEnabledHtml=function(n,bb,a9,ba){var a7=n.m_position;var a8=1;var s=false;while(!n.eof()){if(!n.Find("<")){break}var be=n.m_position;var bd=O(n);if(bd==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&ba==ao&&!s){if(!bd.IsSafe()){s=true}}if(bd.closed){continue}if(bd.m_name==a9.m_name){if(bd.closing){a8--;if(a8==0){n.SkipLinespace();n.SkipEol();bb.blockType=ak;bb.data=a9;bb.set_contentEnd(n.m_position);switch(ba){case aM:var bc=this.CreateBlock();bc.buf=n.buf;bc.blockType=r;bc.contentStart=a7;bc.contentLen=be-a7;bb.children=new Array();bb.children.push(bc);break;case aP:case j:var i=new z(this.m_Markdown,ba==j);bb.children=i.ProcessRange(n.buf,a7,be-a7);break;case ao:if(s){bb.blockType=aT;bb.set_contentEnd(n.m_position)}else{var bc=this.CreateBlock();bc.buf=n.buf;bc.blockType=aN;bc.contentStart=a7;bc.contentLen=be-a7;bb.children=new Array();bb.children.push(bc)}break}return true}}else{a8++}}}return false};T.ScanHtml=function(n,bd){var be=n.m_position;var ba=O(n);if(ba==null){return false}if(ba.closing){return false}var s=false;if(this.m_Markdown.SafeMode&&!ba.IsSafe()){s=true}var a7=ba.get_Flags();if((a7&au)==0){return false}if((a7&aW)!=0||ba.closed){n.SkipLinespace();n.SkipEol();bd.contentLen=n.m_position-bd.contentStart;bd.blockType=s?aT:aN;return true}if((a7&a6)!=0){n.SkipLinespace();if(!n.eol()){return false}}if(this.m_Markdown.ExtraMode){var bf=this.GetMarkdownMode(ba);if(bf!=aK){return this.ProcessMarkdownEnabledHtml(n,bd,ba,bf)}}var a8=null;var a9=1;while(!n.eof()){if(!n.Find("<")){break}var bb=n.m_position;var bg=O(n);if(bg==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&!bg.IsSafe()){s=true}if(bg.closed){continue}if(!bg.closing&&this.m_Markdown.ExtraMode&&!s){var bf=this.GetMarkdownMode(bg);if(bf!=aK){var i=this.CreateBlock();if(this.ProcessMarkdownEnabledHtml(n,i,bg,bf)){if(a8==null){a8=new Array()}if(bb>be){var bc=this.CreateBlock();bc.buf=n.buf;bc.blockType=aN;bc.contentStart=be;bc.contentLen=bb-be;a8.push(bc)}a8.push(i);be=n.m_position;continue}else{this.FreeBlock(i)}}}if(bg.m_name==ba.m_name&&!bg.closed){if(bg.closing){a9--;if(a9==0){n.SkipLinespace();n.SkipEol();if(s){bd.blockType=aT;bd.set_contentEnd(n.m_position);return true}if(a8!=null){if(n.m_position>be){var bc=this.CreateBlock();bc.buf=n.buf;bc.blockType=aN;bc.contentStart=be;bc.contentLen=n.m_position-be;a8.push(bc)}bd.blockType=l;bd.set_contentEnd(n.m_position);bd.children=a8;return true}bd.blockType=aN;bd.contentLen=n.m_position-bd.contentStart;return true}}else{a9++}}}return an};T.BuildList=function(bh){var be=bh[0].blockType;var bb=bh[0].get_leadingSpaces();for(var a7=1;a7<bh.length;a7++){if((bh[a7].blockType==J)&&(bh[a7-1].blockType==J||bh[a7-1].blockType==be)){bh[a7-1].set_contentEnd(bh[a7].get_contentEnd());this.FreeBlock(bh[a7]);bh.splice(a7,1);a7--;continue}if(bh[a7].blockType!=aq&&bh[a7].blockType!=an){var bi=bh[a7].get_leadingSpaces();if(bi>bb){bh[a7].blockType=aq;var bd=bh[a7].get_contentEnd();bh[a7].contentStart=bh[a7].lineStart+bi;bh[a7].set_contentEnd(bd)}}}var bg=this.CreateBlock();bg.blockType=(be==L?H:G);bg.children=new Array();for(var a7=0;a7<bh.length;a7++){var a8=a7;while(a8>0&&bh[a8-1].blockType==an){a8--}var ba=a7;while(ba<bh.length-1&&bh[ba+1].blockType!=be){ba++}if(a8==ba){bg.children.push(this.CreateBlock().CopyFrom(bh[a7]))}else{var a9=false;var bc=this.m_Markdown.GetStringBuilder();for(var s=a8;s<=ba;s++){var p=bh[s];bc.Append(p.buf.substr(p.contentStart,p.contentLen));bc.Append("\n");if(bh[s].blockType==an){a9=true}}var bf=this.CreateBlock();bf.blockType=aO;var b=new z(this.m_Markdown);b.m_parentType=be;bf.children=b.Process(bc.ToString());if(!a9){for(var a7=0;a7<bf.children.length;a7++){var n=bf.children[a7];if(n.blockType==J){n.blockType=r}}}bg.children.push(bf)}a7=ba}this.FreeBlocks(bh);bh.length=0;return bg};T.BuildDefinition=function(n){for(var a7=1;a7<n.length;a7++){if((n[a7].blockType==J)&&(n[a7-1].blockType==J||n[a7-1].blockType==o)){n[a7-1].set_contentEnd(n[a7].get_contentEnd());this.FreeBlock(n[a7]);n.splice(a7,1);a7--;continue}}var s=n[0].data;if(n.length==1&&!s){var p=n[0];n.length=0;return p}var ba=this.m_Markdown.GetStringBuilder();for(var a7=0;a7<n.length;a7++){var b=n[a7];ba.Append(b.buf.substr(b.contentStart,b.contentLen));ba.Append("\n")}var a9=this.CreateBlock();a9.blockType=o;var a8=new z(this.m_Markdown);a8.m_parentType=o;a9.children=a8.Process(ba.ToString());this.FreeBlocks(n);n.length=0;return a9};T.BuildDefinitionLists=function(p){var n=null;for(var b=0;b<p.length;b++){switch(p[b].blockType){case e:case o:if(n==null){n=this.CreateBlock();n.blockType=k;n.children=new Array();p.splice(b,0,n);b++}n.children.push(p[b]);p.splice(b,1);b--;break;default:n=null;break}}};T.BuildFootnote=function(n){for(var p=1;p<n.length;p++){if((n[p].blockType==J)&&(n[p-1].blockType==J||n[p-1].blockType==ad)){n[p-1].set_contentEnd(n[p].get_contentEnd());this.FreeBlock(n[p]);n.splice(p,1);p--;continue}}var a8=this.m_Markdown.GetStringBuilder();for(var p=0;p<n.length;p++){var b=n[p];a8.Append(b.buf.substr(b.contentStart,b.contentLen));a8.Append("\n")}var a7=new z(this.m_Markdown);a7.m_parentType=ad;var s=this.CreateBlock();s.blockType=ad;s.data=n[0].data;s.children=a7.Process(a8.ToString());this.FreeBlocks(n);n.length=0;return s};T.ProcessFencedCodeBlock=function(a8,s){a8.Mark();while(a8.current()=="~"){a8.SkipForward(1)}var n=a8.Extract();if(n.length<3){return false}a8.SkipLinespace();if(!a8.eol()){return false}a8.SkipEol();var a7=a8.m_position;if(!a8.Find(n)){return false}if(!B(a8.CharAtOffset(-1))){return false}var i=a8.m_position;a8.SkipForward(n.length);a8.SkipLinespace();if(!a8.eol()){return false}s.blockType=aA;s.children=new Array();i--;var a9=this.CreateBlock();a9.blockType=aq;a9.buf=a8.buf;a9.contentStart=a7;a9.contentLen=i-a7;s.children.push(a9);return true};var aU=0;var aj=1;var ah=2;var S=3;function ay(){this.m_Columns=new Array();this.m_Headers=null;this.m_Rows=new Array()}var T=ay.prototype;T.LeadingBar=false;T.TrailingBar=false;T.ParseRow=function(i){i.SkipLinespace();if(i.eol()){return null}var b=this.LeadingBar;if(this.LeadingBar&&!i.SkipChar("|")){b=true;return null}var n=new Array();while(!i.eol()){i.Mark();while(!i.eol()&&i.current()!="|"){i.SkipForward(1)}n.push(a(i.Extract()));b|=i.SkipChar("|")}if(!b){return null}while(n.length<this.m_Columns.length){n.push("&nbsp;")}i.SkipEol();return n};T.RenderRow=function(p,n,a8,a7){for(var s=0;s<a8.length;s++){n.Append("\t<");n.Append(a7);if(s<this.m_Columns.length){switch(this.m_Columns[s]){case aj:n.Append(' align="left"');break;case ah:n.Append(' align="right"');break;case S:n.Append(' align="center"');break}}n.Append(">");p.m_SpanFormatter.Format2(n,a8[s]);n.Append("</");n.Append(a7);n.Append(">\n")}};T.Render=function(p,n){n.Append("<table>\n");if(this.m_Headers!=null){n.Append("<thead>\n<tr>\n");this.RenderRow(p,n,this.m_Headers,"th");n.Append("</tr>\n</thead>\n")}n.Append("<tbody>\n");for(var s=0;s<this.m_Rows.length;s++){var a7=this.m_Rows[s];n.Append("<tr>\n");this.RenderRow(p,n,a7,"td");n.Append("</tr>\n")}n.Append("</tbody>\n");n.Append("</table>\n")};function F(a7){a7.SkipLinespace();if(a7.current()!="|"&&a7.current()!=":"&&a7.current()!="-"){return null}var i=null;if(a7.SkipChar("|")){i=new ay();i.LeadingBar=true}while(true){a7.SkipLinespace();if(a7.current()=="|"){return null}var s=a7.SkipChar(":");while(a7.current()=="-"){a7.SkipForward(1)}var b=a7.SkipChar(":");a7.SkipLinespace();var n=aU;if(s&&b){n=S}else{if(s){n=aj}else{if(b){n=ah}}}if(a7.eol()){if(i==null){return null}i.m_Columns.push(n);return i}if(!a7.SkipChar("|")){return null}if(i==null){i=new ay()}i.m_Columns.push(n);a7.SkipLinespace();if(a7.eol()){i.TrailingBar=true;return i}}}this.Markdown=X}();