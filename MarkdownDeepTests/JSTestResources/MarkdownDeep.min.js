if(Array.prototype.indexOf==undefined){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]===b){return a}}return -1}}var MarkdownDeep=new function(){function e(){this.m_SpanFormatter=new t(this);this.m_SpareBlocks=new Array();this.m_StringBuilder=new V();this.SafeMode=false;this.ExtraMode=false;this.MarkdownInHtml=false;this.AutoHeadingIDs=false}var ak=e.prototype;ak.Transform=function(p){var az=p.indexOf("\r");if(az>=0){var aB=p.indexOf("\n");if(aB>=0){if(aB<az){p=p.replace(/\n\r/g,"\n")}else{p=p.replace(/\r\n/g,"\n")}}p=p.replace(/\r/g,"\n")}this.m_LinkDefinitions=new Array();this.m_UsedHeaderIDs=new Array();var ay=new z(this,this.MarkdownInHtml).Process(p);var aA=this.GetStringBuilder();for(var s=0;s<ay.length;s++){var n=ay[s];n.Render(this,aA)}return aA.ToString()};ak.AddLinkDefinition=function(b){this.m_LinkDefinitions[b.id]=b};ak.GetLinkDefinition=function(i){var b=this.m_LinkDefinitions[i];if(b==undefined){return null}else{return b}};ak.MakeUniqueHeaderID=function(n,b,s){if(!this.AutoHeadingIDs){return null}var ay=this.m_SpanFormatter.MakeID(n,b,s);if(!ay){ay="section"}var p=ay;var i=1;while(this.m_UsedHeaderIDs[p]!=undefined){p=ay+"-"+i.toString();i++}this.m_UsedHeaderIDs[p]=true;return p};ak.GetStringBuilder=function(){this.m_StringBuilder.Clear();return this.m_StringBuilder};ak.processSpan=function(p,i,n,b){return this.m_SpanFormatter.Format(p,i,n,b)};var y={};y.is_digit=function(b){return b>="0"&&b<="9"};y.is_hex=function(b){return(b>="0"&&b<="9")||(b>="a"&&b<="f")||(b>="A"&&b<="F")};y.is_alpha=function(b){return(b>="a"&&b<="z")||(b>="A"&&b<="Z")};y.is_alphadigit=function(b){return(b>="a"&&b<="z")||(b>="A"&&b<="Z")||(b>="0"&&b<="9")};y.is_whitespace=function(b){return(b==" "||b=="\t"||b=="\r"||b=="\n")};y.is_linespace=function(b){return(b==" "||b=="\t")};y.is_lineend=function(b){return(b=="\r"||b=="\n")};y.is_emphasis=function(b){return(b=="*"||b=="_")};y.is_escapable=function(b){switch(b){case"\\":case"`":case"*":case"_":case"{":case"}":case"[":case"]":case"(":case")":case"#":case"+":case"-":case".":case"!":case">":return true}return false};function d(i,n){if(i.charAt(n)!="&"){return -1}var b=n;n++;if(i.charAt(n)=="#"){n++;if(i.charAt(n)=="x"||i.charAt(n)=="X"){n++;fn_test=y.is_hex}else{fn_test=y.is_digit}}else{fn_test=y.is_alphadigit}if(fn_test(i.charAt(n))){n++;while(fn_test(i.charAt(n))){n++}if(i.charAt(n)==";"){n++;return n}}n=b;return -1}function F(s){var n=s.indexOf("\\");if(n<0){return s}var i=new V();var p=0;while(n>=0){if(y.is_escapable(s.charAt(n+1))){if(n>p){i.Append(s.substr(p,n-p))}p=n+1}n=s.indexOf("\\",n+1)}if(p<s.length){i.Append(s.substr(p,s.length-p))}return i.ToString()}function am(p){var n=0;var b=p.length;while(n<b&&y.is_whitespace(p.charAt(n))){n++}while(b-1>n&&y.is_whitespace(p.charAt(n-1))){n--}return p.substr(n,b-n)}function ad(n){var b=n.indexOf("@");if(b<0){return false}var i=n.lastIndexOf(".");if(i<b){return false}return true}function h(b){b=b.toLowerCase();if(b.substr(0,7)=="http://"){return true}if(b.substr(0,8)=="https://"){return true}if(b.substr(0,6)=="ftp://"){return true}if(b.substr(0,7)=="file://"){return true}return false}function I(p){if(!p){return false}if(!y.is_alpha(p.charAt(0))){return false}for(var b=0;b<p.length;b++){var n=p.charAt(b);if(y.is_alphadigit(n)||n=="_"||n=="-"||n==":"||n=="."){continue}return false}return true}function R(s,az,i){var ay=i-1;while(ay>=az&&y.is_whitespace(s.charAt(ay))){ay--}if(ay<az||s.charAt(ay)!="}"){return null}var p=ay;ay--;while(ay>=az&&s.charAt(ay)!="{"){ay--}if(ay<az||s.charAt(ay+1)!="#"){return null}var b=ay+2;var n=s.substr(b,p-b);if(!I(n)){return null}while(ay>az&&y.is_whitespace(s.charAt(ay-1))){ay--}return{id:n,end:ay}}function V(){this.content=new Array()}ak=V.prototype;ak.Append=function(b){if(b){this.content.push(b)}};ak.Clear=function(){this.content.length=0};ak.ToString=function(){return this.content.join("")};ak.HtmlRandomize=function(p){var n=p.length;for(var s=0;s<n;s++){var b=Math.random();if(b>0.9&&p.charAt(s)!="@"){this.Append(p.charAt(s))}else{if(b>0.45){this.Append("&#");this.Append(p.charCodeAt(s).toString());this.Append(";")}else{this.Append("&#x");this.Append(p.charCodeAt(s).toString(16));this.Append(";")}}}};ak.HtmlEncode=function(az,b,ay){var n=b+ay;var s=b;for(var p=b;p<n;p++){switch(az.charAt(p)){case"&":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&amp;");s=p+1;break;case"<":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(az.substr(s,p-s))}this.Append("&quot;");s=p+1;break}}if(p>s){this.Append(az.substr(s,p-s))}};ak.SmartHtmlEncodeAmpsAndAngles=function(aA,b,ay){var n=b+ay;var s=b;for(var p=b;p<n;p++){switch(aA.charAt(p)){case"&":var az=d(aA,p);if(az<0){if(p>s){this.Append(aA.substr(s,p-s))}this.Append("&amp;");s=p+1}else{p=az-1}break;case"<":if(p>s){this.Append(aA.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(aA.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(aA.substr(s,p-s))}this.Append("&quot;");s=p+1;break}}if(p>s){this.Append(aA.substr(s,p-s))}};ak.SmartHtmlEncodeAmps=function(aA,b,ay){var n=b+ay;var s=b;for(var p=b;p<n;p++){switch(aA.charAt(p)){case"&":var az=d(aA,p);if(az<0){if(p>s){this.Append(aA.substr(s,p-s))}this.Append("&amp;");s=p+1}else{p=az-1}break}}if(p>s){this.Append(aA.substr(s,p-s))}};ak.HtmlEncodeAndConvertTabsToSpaces=function(az,b,ay){var n=b+ay;var s=b;var aA=0;for(var p=b;p<n;p++){switch(az.charAt(p)){case"\t":if(p>s){this.Append(az.substr(s,p-s))}s=p+1;this.Append(" ");aA++;while((aA%4)!=0){this.Append(" ");aA++}aA--;break;case"\r":case"\n":if(p>s){this.Append(az.substr(s,p-s))}this.Append("\n");s=p+1;continue;case"&":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&amp;");s=p+1;break;case"<":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&lt;");s=p+1;break;case">":if(p>s){this.Append(az.substr(s,p-s))}this.Append("&gt;");s=p+1;break;case'"':if(p>s){this.Append(az.substr(s,p-s))}this.Append("&quot;");s=p+1;break}aA++}if(p>s){this.Append(az.substr(s,p-s))}};function q(){this.reset.apply(this,arguments)}ak=q.prototype;ak.bof=function(){return this.position==this.start};ak.eof=function(){return this.position>=this.end};ak.eol=function(){if(this.position>=this.end){return true}var b=this.buf.charAt(this.position);return b=="\r"||b=="\n"||b==undefined||b==""};ak.reset=function(){this.buf=arguments.length>0?arguments[0]:null;this.start=arguments.length>1?arguments[1]:0;this.end=arguments.length>2?this.start+arguments[2]:(this.buf==null?0:this.buf.length);this.position=this.start;this.charset_offsets={}};ak.current=function(){if(this.position>=this.end){return"\0"}return this.buf.charAt(this.position)};ak.remainder=function(){return this.buf.substr(this.position)};ak.SkipToEof=function(){this.position=this.end};ak.SkipForward=function(b){this.position+=b};ak.SkipToEol=function(){this.position=this.buf.indexOf("\n",this.position);if(this.position<0){this.position=this.end}};ak.SkipEol=function(){var b=this.position;if(this.buf.charAt(this.position)=="\r"){this.position++}if(this.buf.charAt(this.position)=="\n"){this.position++}return this.position!=b};ak.SkipToNextLine=function(){this.SkipToEol();this.SkipEol()};ak.CharAtOffset=function(b){if(this.position+b>=this.end){return"\0"}return this.buf.charAt(this.position+b)};ak.SkipChar=function(b){if(this.buf.charAt(this.position)==b){this.position++;return true}return false};ak.SkipString=function(b){if(this.buf.substr(this.position,b.length)==b){this.position+=b.length;return true}return false};ak.SkipWhitespace=function(){var i=this.position;while(true){var b=this.buf.charAt(this.position);if(b!=" "&&b!="\t"&&b!="\r"&&b!="\n"){break}this.position++}return this.position!=i};ak.SkipLinespace=function(){var i=this.position;while(true){var b=this.buf.charAt(this.position);if(b!=" "&&b!="\t"){break}this.position++}return this.position!=i};ak.FindRE=function(i){i.lastIndex=this.position;var b=i.exec(this.buf);if(b==null){this.position=this.end;return false}if(b.index+b[0].length>this.end){this.position=this.end;return false}this.position=b.index;return true};ak.FindOneOf=function(p){var i=-1;for(var b in p){var n=p[b];if(n==null){n={};n.searched_from=-1;n.found_at=-1;p[b]=n}if(n.searched_from==-1||this.position<n.searched_from||(this.position>=n.found_at&&n.found_at!=-1)){n.searched_from=this.position;n.found_at=this.buf.indexOf(b,this.position)}if(i==-1||n.found_at<i){i=n.found_at}}if(i==-1){i=this.end;return false}ak.position=i;return true};ak.Find=function(b){this.position=this.buf.indexOf(b,this.position);if(this.position<0){this.position=this.end;return false}return true};ak.Mark=function(){this.mark=this.position};ak.Extract=function(){if(this.mark>=this.position){return""}else{return this.buf.substr(this.mark,this.position-this.mark)}};ak.SkipIdentifier=function(){var b=this.buf.charAt(this.position);if((b>="a"&&b<="z")||(b>="A"&&b<="Z")||b=="_"){this.position++;while(true){var b=this.buf.charAt(this.position);if((b>="a"&&b<="z")||(b>="A"&&b<="Z")||b=="_"||(b>="0"&&b<="9")){this.position++}else{return true}}}return false};ak.SkipHtmlEntity=function(){if(this.buf.charAt(this.position)!="&"){return false}var b=d(this.buf,this.position);if(b<0){return false}this.position=b;return true};ak.SkipEscapableChar=function(){if(this.buf.charAt(this.position)=="\\"&&y.is_escapable(this.buf.charAt(this.position+1))){this.position+=2;return true}else{if(this.position<this.end){this.position++}return false}};var r=1;var x=2;var M=4;var j=8;function k(b){this.name=b;this.attributes={};this.flags=0}ak=k.prototype;ak.attributes=null;ak.closed=false;ak.closing=false;ak.attributeCount=function(){if(!this.attributes){return 0}var i=0;for(var b in this.attributes){i++}return i};ak.get_Flags=function(){if(this.flags==0){this.flags=tag_flags[this.name.toLowerCase()];if(this.flags==undefined){this.flags=x}}return this.flags};ak.IsSafe=function(){var b=this.name.toLowerCase();if(!allowed_tags[b]){return false}var p=allowed_attributes[b];if(!p){return this.attributeCount()==0}if(!this.attributes){return true}for(var n in this.attributes){if(!p[n.toLowerCase()]){return false}}if(this.attributes.href){if(!k.IsSafeUrl(this.attributes.href)){return false}}if(this.attributes.src){if(!k.IsSafeUrl(this.attributes.src)){return false}}return true};ak.RenderOpening=function(b){b.Append("<");b.Append(this.name);for(var n in this.m_attributes){b.Append(" ");b.Append(n);b.Append('="');b.Append(this.m_attributes[n]);b.Append('"')}b.Append(">\n")};ak.RenderClosing=function(b){b.Append("</");b.Append(this.name);b.Append(">\n")};k.IsSafeUrl=function(b){b=b.toLowerCase();return(b.substr(0,7)=="http://"||b.substr(0,8)=="https://"||b.substr(0,6)=="ftp://")};k.Parse=function(n){var i=n.position;var b=this.ParseHelper(n);if(b!=null){return b}n.position=i;return null};k.ParseHelper=function(ay){if(ay.current()!="<"){return null}ay.SkipForward(1);if(ay.SkipString("!--")){ay.Mark();if(ay.Find("-->")){var n=new k("!");n.attributes.content=ay.Extract();n.closed=true;ay.SkipForward(3);return n}}var s=ay.SkipChar("/");ay.Mark();if(!ay.SkipIdentifier()){return null}var b=new k(ay.Extract());b.closing=s;if(s){if(ay.current()!=">"){return null}ay.SkipForward(1);return b}while(!ay.eof()){ay.SkipWhitespace();if(ay.SkipString("/>")){b.closed=true;return b}if(ay.SkipChar(">")){return b}ay.Mark();if(!ay.SkipIdentifier()){return null}var i=ay.Extract();ay.SkipWhitespace();if(!ay.SkipChar("=")){return null}ay.SkipWhitespace();if(ay.SkipChar('"')){ay.Mark();if(!ay.Find('"')){return null}b.attributes[i]=ay.Extract();ay.SkipForward(1)}else{ay.Mark();while(!ay.eof()&&!y.is_whitespace(ay.current())&&ay.current()!=">"&&ay.current()!="/"){ay.SkipForward(1)}if(!ay.eof()){b.attributes[i]=ay.Extract()}}}return null};allowed_tags={b:1,blockquote:1,code:1,dd:1,dt:1,dl:1,del:1,em:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,kbd:1,li:1,ol:1,ul:1,p:1,pre:1,s:1,sub:1,sup:1,strong:1,strike:1,img:1,a:1};allowed_attributes={a:{href:1,title:1},img:{src:1,width:1,height:1,alt:1,title:1}};var at=r;var ao=x;var al=M;var ai=j;tag_flags={p:at|ai,div:at,h1:at|ai,h2:at|ai,h3:at|ai,h4:at|ai,h5:at|ai,h6:at|ai,blockquote:at,pre:at,table:at,dl:at,ol:at,ul:at,form:at,fieldset:at,iframe:at,script:at|ao,noscript:at|ao,math:at|ao,ins:at|ao,del:at|ao,img:at|ao,li:ai,dd:ai,dt:ai,td:ai,th:ai,legend:ai,address:ai,hr:at|al,"!":at|al};delete at;delete ao;delete al;function S(n,b,i){this.id=n;this.url=b;if(i==undefined){this.title=null}else{this.title=i}}ak=S.prototype;ak.RenderLink=function(n,i,p){if(this.url.substr(0,7).toLowerCase()=="mailto:"){i.Append('<a href="');i.HtmlRandomize(this.url);i.Append('"');if(this.title){i.Append(' title="');i.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);i.Append('"')}i.Append(">");i.HtmlRandomize(p);i.Append("</a>")}else{i.Append('<a href="');i.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);i.Append('"');if(this.title){i.Append(' title="');i.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);i.Append('"')}i.Append(">");i.Append(p);i.Append("</a>")}};ak.RenderImg=function(n,i,p){i.Append('<img src="');i.SmartHtmlEncodeAmpsAndAngles(this.url,0,this.url.length);i.Append('"');if(p){i.Append(' alt="');i.SmartHtmlEncodeAmpsAndAngles(p,0,p.length);i.Append('"')}if(this.title){i.Append(' title="');i.SmartHtmlEncodeAmpsAndAngles(this.title,0,this.title.length);i.Append('"')}i.Append(" />")};S.ParseLinkDefinition=function(n){var i=n.position;var b=S.ParseLinkDefinitionInternal(n);if(b==null){n.position=i}return b};S.ParseLinkDefinitionInternal=function(i){i.SkipWhitespace();if(!i.SkipChar("[")){return null}i.Mark();if(!i.Find("]")){return null}var n=i.Extract();if(n.length==0){return null}if(!i.SkipString("]:")){return null}var b=this.ParseLinkTarget(i,n);i.SkipLinespace();if(!i.eol()){return null}return b};S.ParseLinkTarget=function(az,ay){az.SkipWhitespace();if(az.eol()){return null}var b=new S(ay);if(az.SkipChar("<")){az.Mark();while(az.current()!=">"){if(az.eof()){return null}az.SkipEscapableChar()}var s=az.Extract();if(!az.SkipChar(">")){return null}b.url=F(am(s));az.SkipWhitespace()}else{az.Mark();var n=1;while(!az.eol()){var i=az.current();if(y.is_whitespace(i)){break}if(ay==null){if(i=="("){n++}else{if(i==")"){n--;if(n==0){break}}}}az.SkipEscapableChar()}b.url=F(am(az.Extract()))}az.SkipLinespace();if(az.current()==")"){return b}var aD=az.eol();var aC=az.position;if(az.eol()){az.SkipEol();az.SkipLinespace()}var aB;switch(az.current()){case"'":case'"':aB=az.current();break;case"(":aB=")";break;default:if(aD){az.position=aC;return b}else{return null}}az.SkipForward(1);az.Mark();while(true){if(az.eol()){return null}if(az.current()==aB){if(aB!=")"){var aA=az.position;az.SkipForward(1);az.SkipLinespace();if((ay==null&&az.current()!=")")||(ay!=null&&!az.eol())){continue}az.position=aA}break}az.SkipEscapableChar()}b.title=F(az.Extract());az.SkipForward(1);return b};function N(i,b){this.def=i;this.link_text=b}var af=0;var ax=1;var ag=2;var H=3;var ac=4;var l=5;var W=6;var aa=7;var ap=8;var Q=9;var O=10;var ae=11;var ab=12;var Z=13;function g(i,b,n){this.type=i;this.startOffset=b;this.length=n;this.data=null}function t(b){this.m_Markdown=b;this.m_Scanner=new q();this.m_SpareTokens=new Array();this.DisableLinks=false}ak=t.prototype;ak.Format=function(n,ay,az,b){this.m_Scanner.reset(ay,az,b);var s=this.Tokenize();if(s==null){n.HtmlEncode(ay,az,b)}else{this.RenderTokens(n,ay,s);for(var p=0;p<s.length;p++){this.FreeToken(s[p])}}};ak.FormatDirect=function(i){var b=new V();this.Format(b,i,0,i.length);return b.ToString()};ak.MakeID=function(aA,n,az){var s=this.m_Scanner;s.reset(aA,n,az);var aB=this.Tokenize();var aC=new V();if(aB==null){aC.Append(aA.substr(n,az))}else{for(var ay=0;ay<aB.length;ay++){var aD=aB[ay];switch(aD.type){case af:aC.Append(aA.substr(aD.startOffset,aD.length));break;case Q:aC.Append(aD.data.link_text);break}}}s.reset(aC.ToString());while(!s.eof()){if(y.is_alpha(s.current())){break}s.SkipForward(1)}aC.Clear();while(!s.eof()){var b=s.current();if(y.is_alphadigit(b)||b=="_"||b=="-"||b=="."){aC.Append(b.toLowerCase())}else{if(b==" "){aC.Append("-")}else{if(y.is_lineend(b)){aC.Append("-");s.SkipEol();continue}}}s.SkipForward(1)}return aC.ToString()};ak.RenderTokens=function(aB,aA,az){var n=az.length;for(var s=0;s<n;s++){var p=az[s];switch(p.type){case af:aB.HtmlEncode(aA,p.startOffset,p.length);break;case ax:aB.SmartHtmlEncodeAmps(aA,p.startOffset,p.length);break;case ag:case ae:case ab:case Z:aB.Append(aA.substr(p.startOffset,p.length));break;case ap:aB.Append("<br />\n");break;case H:aB.Append("<em>");break;case ac:aB.Append("</em>");break;case l:aB.Append("<strong>");break;case W:aB.Append("</strong>");break;case aa:aB.Append("<code>");aB.HtmlEncode(aA,p.startOffset,p.length);aB.Append("</code>");break;case Q:var b=p.data;var ay=new t(this.m_Markdown);ay.DisableLinks=true;b.def.RenderLink(this.m_Markdown,aB,ay.FormatDirect(b.link_text));break;case O:var b=p.data;b.def.RenderImg(this.m_Markdown,aB,b.link_text);break}}};ak.Tokenize=function(){var i=this.m_Scanner;var aA=null;var b=null;var aC=/[\*\_\`\[\!\<\&\ \\]/g;var aB=i.position;while(!i.eof()){if(!i.FindRE(aC)){break}var ay=i.position;var s=null;switch(i.current()){case"*":case"_":s=this.CreateEmphasisMark();switch(s.type){case Z:case ae:case ab:if(b==null){b=new Array()}b.push(s);break}break;case"`":s=this.ProcessCodeSpan();break;case"[":case"!":var n=i.position;s=this.ProcessLinkOrImage();if(s==null){i.position=n}break;case"<":var az=i.position;var aD=k.Parse(i);if(aD!=null){if(!this.m_Markdown.SafeMode||aD.IsSafe()){s=this.CreateToken(ax,az,i.position-az)}else{i.position=az}}else{i.position=az;s=this.ProcessAutoLink();if(s==null){i.position=az}}break;case"&":var az=i.position;if(i.SkipHtmlEntity()){s=this.CreateToken(ag,az,i.position-az)}break;case" ":if(i.CharAtOffset(1)==" "&&y.is_lineend(i.CharAtOffset(2))){i.SkipForward(2);if(!i.eof()){i.SkipEol();s=this.CreateToken(ap,ay,0)}}break;case"\\":if(y.is_escapable(i.CharAtOffset(1))){s=this.CreateToken(af,i.position+1,1);i.SkipForward(2)}break}if(s!=null){if(aA==null){aA=new Array()}if(ay>aB){aA.push(this.CreateToken(af,aB,ay-aB))}aA.push(s);aB=i.position}else{i.SkipForward(1)}}if(aA==null){return null}if(i.position>aB){aA.push(this.CreateToken(af,aB,i.position-aB))}if(b!=null){this.ResolveEmphasisMarks(aA,b)}return aA};ak.CreateEmphasisMark=function(){var aA=this.m_Scanner;var n=aA.current();var az=n=="*"?"_":"*";var ay=aA.position;if(aA.bof()||y.is_whitespace(aA.CharAtOffset(-1))){while(y.is_emphasis(aA.current())){aA.SkipForward(1)}if(aA.eof()||y.is_whitespace(aA.current())){return this.CreateToken(ag,ay,aA.position-ay)}aA.position=ay}while(y.is_emphasis(aA.CharAtOffset(-1))){aA.SkipForward(-1)}var b=aA.bof()||y.is_whitespace(aA.CharAtOffset(-1));aA.position=ay;while(aA.current()==n){aA.SkipForward(1)}var s=aA.position-ay;while(y.is_emphasis(aA.CharAtOffset(1))){aA.SkipForward(1)}var i=aA.eof()||y.is_whitespace(aA.CharAtOffset(1));aA.position=ay+s;if(b){return this.CreateToken(ae,ay,aA.position-ay)}if(i){return this.CreateToken(ab,ay,aA.position-ay)}return this.CreateToken(Z,ay,aA.position-ay)};ak.SplitMarkToken=function(s,n,i,b){var p=this.CreateToken(i.type,i.startOffset+b,i.length-b);i.length=b;n.splice(n.indexOf(i)+1,0,p);s.splice(s.indexOf(i)+1,0,p);return p};ak.ResolveEmphasisMarks=function(az,aB){var aC=this.m_Scanner.buf;var aA=true;while(aA){aA=false;for(var s=0;s<aB.length;s++){var ay=aB[s];if(ay.type!=ae&&ay.type!=Z){continue}for(var p=s+1;p<aB.length;p++){var n=aB[p];if(n.type!=ab&&n.type!=Z){break}if(aC.charAt(ay.startOffset)!=aC.charAt(n.startOffset)){continue}var b=Math.min(ay.length,n.length);if(b>=3){b=(b%2)==1?1:2}if(ay.length>b){ay=this.SplitMarkToken(az,aB,ay,ay.length-b);s--}if(n.length>b){this.SplitMarkToken(az,aB,n,b)}ay.type=b==1?H:l;n.type=b==1?ac:W;aB.splice(aB.indexOf(ay),1);aB.splice(aB.indexOf(n),1);aA=true;break}}}};ak.ProcessAutoLink=function(){if(this.DisableLinks){return null}var ay=this.m_Scanner;ay.SkipForward(1);ay.Mark();while(!ay.eof()){var s=ay.current();if(y.is_whitespace(s)){break}if(s==">"){var n=F(ay.Extract());var b=null;if(ad(n)){var i;if(n.toLowerCase().substr(0,7)=="mailto:"){i=n.substr(7)}else{i=n;n="mailto:"+n}b=new N(new S("auto",n,null),i)}else{if(h(n)){b=new N(new S("auto",n,null),n)}}if(b!=null){ay.SkipForward(1);return this.CreateDataToken(Q,b)}return null}ay.SkipEscapableChar()}return null};ak.ProcessLinkOrImage=function(){if(this.DisableLinks){return null}var ay=this.m_Scanner;var aG=ay.SkipChar("!")?O:Q;if(!ay.SkipChar("[")){return null}ay.Mark();var aF=1;while(!ay.eof()){var b=ay.current();if(b=="["){aF++}else{if(b=="]"){aF--;if(aF==0){break}}}ay.SkipEscapableChar()}if(ay.eof()){return null}var n=F(ay.Extract());ay.SkipForward(1);var aA=ay.position;if(ay.SkipChar("(")){var aD=S.ParseLinkTarget(ay,null);if(aD==null){return null}ay.SkipWhitespace();if(!ay.SkipChar(")")){return null}return this.CreateDataToken(aG,new N(aD,n))}if(!ay.SkipChar(" ")){ay.SkipChar("\t")}if(ay.eol()){ay.SkipEol();ay.SkipLinespace()}var aB=null;if(ay.current()=="["){ay.SkipForward(1);ay.Mark();if(!ay.Find("]")){return null}aB=ay.Extract();ay.SkipForward(1)}else{ay.position=aA}if(!aB){aB=n;while(true){var aE=aB.indexOf("\n");if(aE<0){break}var s=aE;while(s>0&&y.is_whitespace(aB.charAt(s-1))){s--}var aC=aE;while(aC<aB.length&&y.is_whitespace(aB.charAt(aC))){aC++}aB=aB.substr(0,s)+" "+aB.substr(aC)}}var az=this.m_Markdown.GetLinkDefinition(aB);if(az==null){return null}return this.CreateDataToken(aG,new N(az,n))};ak.ProcessCodeSpan=function(){var ay=this.m_Scanner;var az=ay.position;var n=0;while(ay.SkipChar("`")){n++}ay.SkipWhitespace();if(ay.eof()){return this.CreateToken(af,az,ay.position-az)}var i=ay.position;if(!ay.Find(ay.buf.substr(az,n))){return this.CreateToken(af,az,ay.position-az)}var s=ay.position+n;while(y.is_whitespace(ay.CharAtOffset(-1))){ay.SkipForward(-1)}var b=this.CreateToken(aa,i,ay.position-i);ay.position=s;return b};ak.CreateToken=function(n,b,p){if(this.m_SpareTokens.length!=0){var i=this.m_SpareTokens.pop();i.type=n;i.startOffset=b;i.length=p;i.data=null;return i}else{return new g(n,b,p)}};ak.CreateDataToken=function(i,n){if(this.m_SpareTokens.length!=0){var b=this.m_SpareTokens.pop();b.type=i;b.data=n;return b}else{var b=new g(i,0,0);b.data=n;return b}};ak.FreeToken=function(b){b.data=null;this.m_SpareTokens.push(b)};var f=0;var D=1;var C=2;var B=3;var A=4;var w=5;var u=6;var aw=7;var av=8;var G=9;var Y=10;var a=11;var aq=12;var L=13;var X=14;var v=15;var ar=16;var m=17;var o=18;var K=19;var J=20;var P=21;var aj=22;var ah=23;function au(){}ak=au.prototype;ak.buf=null;ak.blockType=f;ak.contentStart=0;ak.contentLen=0;ak.lineStart=0;ak.lineLen=0;ak.children=null;ak.data=null;ak.get_Content=function(){if(this.buf==null){return null}if(this.contentStart==-1){return this.buf}return this.buf.substr(this.contentStart,this.contentLen)};ak.get_CodeContent=function(){var n=new V();for(var b=0;b<this.children.length;b++){n.Append(this.children[b].get_Content());n.Append("\n")}return n.ToString()};ak.RenderChildren=function(p,n){for(var s=0;s<this.children.length;s++){this.children[s].Render(p,n)}};ak.ResolveHeaderID=function(b){if(this.data!=null){return this.data}var i=R(this.buf,this.contentStart,this.get_contentEnd());var n=null;if(i!=null){this.set_contentEnd(i.end);n=i.id}else{n=b.MakeUniqueHeaderID(this.buf,this.contentStart,this.contentLen)}this.data=n;return n};ak.Render=function(p,n){switch(this.blockType){case f:return;case aq:n.Append("<p>");p.processSpan(n,this.buf,this.contentStart,this.contentLen);n.Append("</p>\n");break;case m:p.processSpan(n,this.buf,this.contentStart,this.contentLen);n.Append("\n");break;case D:case C:case B:case A:case w:case u:if(p.ExtraMode&&!p.SafeMode){n.Append("<h"+(this.blockType-D+1).toString());var az=this.ResolveHeaderID(p);if(az){n.Append(' id="');n.Append(az);n.Append('">')}else{n.Append(">")}}else{n.Append("<h"+(this.blockType-D+1).toString()+">")}p.processSpan(n,this.buf,this.contentStart,this.contentLen);n.Append("</h"+(this.blockType-D+1).toString()+">\n");break;case X:n.Append("<hr />\n");return;case Y:case a:n.Append("<li>");p.processSpan(n,this.buf,this.contentStart,this.contentLen);n.Append("</li>\n");break;case v:n.Append(this.buf.substr(this.contentStart,this.contentLen));return;case ar:n.HtmlEncode(this.buf,this.contentStart,this.contentLen);return;case o:n.Append("<pre><code>");for(var ay=0;ay<this.children.length;ay++){var s=this.children[ay];n.HtmlEncodeAndConvertTabsToSpaces(s.buf,s.contentStart,s.contentLen);n.Append("\n")}n.Append("</code></pre>\n\n");return;case G:n.Append("<blockquote>\n");this.RenderChildren(p,n);n.Append("</blockquote>\n");return;case K:n.Append("<li>\n");this.RenderChildren(p,n);n.Append("</li>\n");return;case J:n.Append("<ol>\n");this.RenderChildren(p,n);n.Append("</ol>\n");return;case P:n.Append("<ul>\n");this.RenderChildren(p,n);n.Append("</ul>\n");return;case aj:this.data.RenderOpening(n);this.RenderChildren(p,n);this.data.RenderClosing(n);return;case ah:this.RenderChildren(p,n);return}};ak.RevertToPlain=function(){this.blockType=aq;this.contentStart=this.lineStart;this.contentLen=this.lineLen};ak.get_contentEnd=function(){return this.contentStart+this.contentLen};ak.set_contentEnd=function(b){this.contentLen=b-this.contentStart};ak.get_leadingSpaces=function(){var n=0;for(var b=this.lineStart;b<this.lineStart+this.lineLen;b++){if(this.buf.charAt(b)==" "){n++}else{break}}return n};ak.CopyFrom=function(b){this.blockType=b.blockType;this.buf=b.buf;this.contentStart=b.contentStart;this.contentLen=b.contentLen;this.lineStart=b.lineStart;this.lineLen=b.lineLen;return this};function z(b,i){this.m_Markdown=b;this.m_parentType=f;this.m_bMarkdownInHtml=i}ak=z.prototype;ak.Process=function(i){var b=new q(i);return this.ScanLines(b)};ak.ProcessRange=function(s,i,b){var n=new q(s,i,b);return this.ScanLines(n)};ak.ScanLines=function(ay){var az=new Array();var n=new Array();while(!ay.eof()){var i=this.EvaluateLine(ay);if(i.blockType==aw||i.blockType==av){if(n.length>0){var aA=n.pop();this.CollapseLines(az,n);if(aA.blockType!=f){aA.RevertToPlain();aA.blockType=i.blockType==aw?D:C;az.push(aA);continue}}if(i.blockType==aw){i.RevertToPlain();n.push(i)}else{if(i.contentLen>=3){i.blockType=X;az.push(i)}else{i.RevertToPlain();n.push(i)}}continue}var s=n.length>0?n[0].blockType:f;switch(i.blockType){case f:switch(s){case f:this.FreeBlock(i);break;case aq:this.CollapseLines(az,n);this.FreeBlock(i);break;case G:case Y:case a:case L:n.push(i);break}break;case aq:switch(s){case f:case aq:n.push(i);break;case G:case Y:case a:var aA=n[n.length-1];if(aA.blockType==f){this.CollapseLines(az,n);n.push(i)}else{n.push(i)}break;case L:this.CollapseLines(az,n);n.push(i);break}break;case L:switch(s){case f:n.push(i);break;case aq:case G:var aA=n[n.length-1];if(aA.blockType==f){this.CollapseLines(az,n);n.push(i)}else{i.RevertToPlain();n.push(i)}break;case Y:case a:case L:n.push(i);break}break;case G:if(s!=G){this.CollapseLines(az,n)}n.push(i);break;case Y:case a:switch(s){case f:n.push(i);break;case aq:case G:var aA=n[n.length-1];if(aA.blockType==f||this.m_parentType==Y||this.m_parentType==a){this.CollapseLines(az,n);n.push(i)}else{i.RevertToPlain();n.push(i)}break;case Y:case a:if(i.blockType!=s){this.CollapseLines(az,n)}n.push(i);break;case L:this.CollapseLines(az,n);n.push(i);break}break;default:this.CollapseLines(az,n);az.push(i);break}}this.CollapseLines(az,n);return az};ak.CreateBlock=function(){if(this.m_Markdown.m_SpareBlocks.length>1){return this.m_Markdown.m_SpareBlocks.pop()}else{return new au()}};ak.FreeBlock=function(i){this.m_Markdown.m_SpareBlocks.push(i)};ak.FreeBlocks=function(n){for(var b=0;b<n.length;b++){this.m_Markdown.m_SpareBlocks.push(n[b])}n.length=0};ak.RenderLines=function(s){var n=this.m_Markdown.GetStringBuilder();for(var ay=0;ay<s.length;ay++){var p=s[ay];n.Append(p.buf.substr(p.contentStart,p.contentLen));n.Append("\n")}return n.ToString()};ak.CollapseLines=function(aB,n){while(n.length>0&&n[n.length-1].blockType==f){this.FreeBlock(n.pop())}if(n.length==0){return}switch(n[0].blockType){case aq:var b=this.CreateBlock();b.blockType=aq;b.buf=n[0].buf;b.contentStart=n[0].contentStart;b.set_contentEnd(n[n.length-1].get_contentEnd());aB.push(b);this.FreeBlocks(n);break;case G:var aA=this.RenderLines(n);var az=new z(this.m_Markdown,this.m_bMarkdownInHtml);az.m_parentType=G;var p=this.CreateBlock();p.blockType=G;p.children=az.Process(aA);this.FreeBlocks(n);aB.push(p);break;case Y:case a:aB.push(this.BuildList(n));break;case L:var ay=this.CreateBlock();ay.blockType=o;ay.children=new Array();for(var s=0;s<n.length;s++){ay.children.push(n[s])}aB.push(ay);n.length=0;break}};ak.EvaluateLine=function(n){var i=this.CreateBlock();i.lineStart=n.position;i.buf=n.buf;i.contentStart=n.position;i.contentLen=-1;i.blockType=this.EvaluateLineInternal(n,i);if(i.contentLen<0){n.SkipToEol();i.contentLen=n.position-i.contentStart}i.lineLen=n.position-i.lineStart;n.SkipEol();return i};ak.EvaluateLineInternal=function(s,aF){if(s.eol()){return f}var az=s.position;var i=s.current();if(i=="#"){var n=1;s.SkipForward(1);while(s.current()=="#"){n++;s.SkipForward(1)}if(n>6){n=6}s.SkipWhitespace();aF.contentStart=s.position;s.SkipToEol();if(this.m_Markdown.ExtraMode&&!this.m_Markdown.SafeMode){var aE=R(s.buf,aF.contentStart,s.position);if(aE!=null){aF.data=aE.id;s.position=aE.end}}while(s.position>aF.contentStart&&s.CharAtOffset(-1)=="#"){s.SkipForward(-1)}while(s.position>aF.contentStart&&y.is_whitespace(s.CharAtOffset(-1))){s.SkipForward(-1)}aF.contentLen=s.position-aF.contentStart;s.SkipToEol();return D+(n-1)}if(i=="-"||i=="="){var aC=i;while(s.current()==aC){s.SkipForward(1)}s.SkipLinespace();if(s.eol()){return aC=="="?aw:av}s.position=az}if(i=="~"&&this.m_Markdown.ExtraMode){if(this.ProcessFencedCodeBlock(s,aF)){return aF.blockType}s.position=az}var aB=-1;var ay=0;while(!s.eol()){if(s.current()==" "){if(aB<0){ay++}}else{if(s.current()=="\t"){if(aB<0){aB=s.position}}else{break}}s.SkipForward(1)}if(s.eol()){aF.contentLen=0;return f}if(ay>=4){aF.contentStart=az+4;return L}if(aB>=0&&aB-az<4){aF.contentStart=aB+1;return L}aF.contentStart=s.position;i=s.current();if(i=="<"){if(this.ScanHtml(s,aF)){return aF.blockType}s.position=aF.contentStart}if(i==">"){if(y.is_linespace(s.CharAtOffset(1))){s.SkipForward(2);aF.contentStart=s.position;return G}s.SkipForward(1);aF.contentStart=s.position;return G}if(i=="-"||i=="_"||i=="*"){var aD=0;while(!s.eol()){var aC=s.current();if(s.current()==i){aD++;s.SkipForward(1);continue}if(y.is_linespace(s.current())){s.SkipForward(1);continue}break}if(s.eol()&&aD>=3){return X}s.position=aF.contentStart}if((i=="*"||i=="+"||i=="-")&&y.is_linespace(s.CharAtOffset(1))){s.SkipForward(1);s.SkipLinespace();aF.contentStart=s.position;return a}if(y.is_digit(i)){s.SkipForward(1);while(y.is_digit(s.current())){s.SkipForward(1)}if(s.SkipChar(".")&&s.SkipLinespace()){aF.contentStart=s.position;return Y}s.position=aF.contentStart}if(i=="["){var aA=S.ParseLinkDefinition(s);if(aA!=null){this.m_Markdown.AddLinkDefinition(aA);return f}}return aq};var c=0;var an=1;var T=2;var E=3;var U=4;ak.GetMarkdownMode=function(b){var i=b.attributes.markdown;if(i==undefined){if(this.m_bMarkdownInHtml){return E}else{return c}}delete b.attributes.markdown;if(i=="1"){return(b.get_Flags()&j)!=0?T:an}if(i=="block"){return an}if(i=="deep"){return E}if(i=="span"){return T}return U};ak.ProcessMarkdownEnabledHtml=function(n,aC,aA,aB){var ay=n.position;var az=1;var s=false;while(!n.eof()){if(!n.Find("<")){break}var aF=n.position;var aE=k.Parse(n);if(aE==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&aB==U&&!s){if(!aE.IsSafe()){s=true}}if(aE.closed){continue}if(aE.name==aA.name){if(aE.closing){az--;if(az==0){n.SkipLinespace();n.SkipEol();aC.blockType=aj;aC.data=aA;aC.contentEnd=n.position;switch(aB){case T:var aD=this.CreateBlock();aD.buf=n.buf;aD.blockType=m;aD.contentStart=ay;aD.contentLen=aF-ay;aC.children=new Array();aC.children.push(aD);break;case an:case E:var i=new z(this.m_Markdown,aB==E);aC.children=i.ProcessRange(n.buf,ay,aF-ay);break;case U:if(s){aC.blockType=ar;aC.contentEnd=n.position}else{var aD=this.CreateBlock();aD.buf=n.buf;aD.blockType=v;aD.contentStart=ay;aD.contentLen=aF-ay;aC.children=new Array();aC.children.push(aD)}break}return true}}else{az++}}}return false};ak.ScanHtml=function(n,aE){var aF=n.position;var aB=k.Parse(n);if(aB==null){return false}if(aB.closing){return false}var s=false;if(this.m_Markdown.SafeMode&&!aB.IsSafe()){s=true}var ay=aB.get_Flags();if((ay&r)==0){return false}if((ay&M)!=0||aB.closed){n.SkipLinespace();n.SkipEol();aE.contentLen=n.position-aE.contentStart;aE.blockType=s?ar:v;return true}if((ay&x)!=0){n.SkipLinespace();if(!n.eol()){return false}}if(this.m_Markdown.ExtraMode){var aG=this.GetMarkdownMode(aB);if(aG!=c){return this.ProcessMarkdownEnabledHtml(n,aE,aB,aG)}}var az=null;var aA=1;while(!n.eof()){if(!n.Find("<")){break}var aC=n.position;var aH=k.Parse(n);if(aH==null){n.SkipForward(1);continue}if(this.m_Markdown.SafeMode&&!aH.IsSafe()){s=true}if(aH.closed){continue}if(!aH.closing&&this.m_Markdown.ExtraMode&&!s){var aG=this.GetMarkdownMode(aH);if(aG!=c){var i=this.CreateBlock();if(this.ProcessMarkdownEnabledHtml(n,i,aH,aG)){if(az==null){az=new Array()}if(aC>aF){var aD=this.CreateBlock();aD.buf=n.buf;aD.blockType=v;aD.contentStart=aF;aD.contentLen=aC-aF;az.push(aD)}az.push(i);aF=n.position;continue}else{this.FreeBlock(i)}}}if(aH.name==aB.name&&!aH.closed){if(aH.closing){aA--;if(aA==0){n.SkipLinespace();n.SkipEol();if(s){aE.blockType=ar;aE.contentEnd=n.position;return true}if(az!=null){if(n.position>aF){var aD=this.CreateBlock();aD.buf=n.buf;aD.blockType=v;aD.contentStart=aF;aD.contentLen=n.position-aF;az.push(aD)}aE.blockType=ah;aE.contentEnd=n.position;aE.children=az;return true}aE.blockType=v;aE.contentLen=n.position-aE.contentStart;return true}}else{aA++}}}return f};ak.BuildList=function(aI){var aF=aI[0].blockType;var aC=aI[0].get_leadingSpaces();for(var ay=1;ay<aI.length;ay++){if((aI[ay].blockType==aq)&&(aI[ay-1].blockType==aq||aI[ay-1].blockType==aF)){aI[ay-1].set_contentEnd(aI[ay].get_contentEnd());this.FreeBlock(aI[ay]);aI.splice(ay,1);ay--;continue}if(aI[ay].blockType!=L&&aI[ay].blockType!=f){var aJ=aI[ay].get_leadingSpaces();if(aJ>aC){aI[ay].blockType=L;var aE=aI[ay].get_contentEnd();aI[ay].contentStart=aI[ay].lineStart+aJ;aI[ay].set_contentEnd(aE)}}}var aH=this.CreateBlock();aH.blockType=(aF==a?P:J);aH.children=new Array();for(var ay=0;ay<aI.length;ay++){var az=ay;while(az>0&&aI[az-1].blockType==f){az--}var aB=ay;while(aB<aI.length-1&&aI[aB+1].blockType!=aF){aB++}if(az==aB){aH.children.push(this.CreateBlock().CopyFrom(aI[ay]))}else{var aA=false;var aD=this.m_Markdown.GetStringBuilder();for(var s=az;s<=aB;s++){var p=aI[s];aD.Append(p.buf.substr(p.contentStart,p.contentLen));aD.Append("\n");if(aI[s].blockType==f){aA=true}}var aG=this.CreateBlock();aG.blockType=K;var b=new z(this.m_Markdown);b.m_parentType=aF;aG.children=b.Process(aD.ToString());if(!aA){for(var ay=0;ay<aG.children.length;ay++){var n=aG.children[ay];if(n.blockType==aq){n.blockType=m}}}aH.children.push(aG)}ay=aB}this.FreeBlocks(aI);aI.length=0;return aH};ak.ProcessFencedCodeBlock=function(az,s){az.Mark();while(az.current()=="~"){az.SkipForward(1)}var n=az.Extract();if(n.length<3){return false}az.SkipLinespace();if(!az.eol()){return false}az.SkipEol();var ay=az.position;if(!az.Find(n)){return false}if(!y.is_lineend(az.CharAtOffset(-1))){return false}var i=az.position;az.SkipForward(n.length);az.SkipLinespace();if(!az.eol()){return false}s.blockType=o;s.children=new Array();i--;var aA=this.CreateBlock();aA.blockType=L;aA.buf=az.buf;aA.contentStart=ay;aA.contentLen=i-ay;s.children.push(aA);return true};this.Markdown=e}();