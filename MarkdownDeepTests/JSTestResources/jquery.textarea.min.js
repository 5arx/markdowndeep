// Minified by MiniME from toptensoftware.com
(function(k){k.fn.tabby=function(e){u(this);var g=k.extend({},k.fn.tabby.defaults,e),f=k.fn.tabby.pressed;return this.each(function(){$this=k(this);var c=k.meta?k.extend({},g,$this.data()):g;$this.bind("keydown",function(b){var a=k.fn.tabby.catch_kc(b);if(16==a)f.shft=true;if(17==a){f.ctrl=true;setTimeout("$.fn.tabby.pressed.ctrl = false;",1000)}if(18==a){f.alt=true;setTimeout("$.fn.tabby.pressed.alt = false;",1000)}if(9==a&&!f.ctrl&&!f.alt){b.preventDefault;f.last=a;setTimeout("$.fn.tabby.pressed.last = null;",0);w(k(b.target).get(0),f.shft,c);return false}}).bind("keyup",function(a){if(16==k.fn.tabby.catch_kc(a))f.shft=false}).bind("blur",function(a){if(9==f.last)k(a.target).one("focus",function(y){f.last=null}).get(0).focus()})})};k.fn.tabby.catch_kc=function(a){return a.keyCode?a.keyCode:a.charCode?a.charCode:a.which};k.fn.tabby.pressed={shft:false,ctrl:false,alt:false,last:null};function u(a){if(window.console&&window.console.log)window.console.log("textarea count: "+a.size())}function w(a,c,b){var d=a.scrollTop;if(a.setSelectionRange)v(a,c,b);else if(document.selection)x(a,c,b);a.scrollTop=d}k.fn.tabby.defaults={tabString:String.fromCharCode(9)};function v(a,l,c){var b=a.selectionStart,h=a.selectionEnd;if(b==h)if(l){if("\t"==a.value.substring(b-c.tabString.length,b)){a.value=a.value.substring(0,b-c.tabString.length)+a.value.substring(b);a.focus();a.setSelectionRange(b-c.tabString.length,b-c.tabString.length)}else if("\t"==a.value.substring(b,b+c.tabString.length)){a.value=a.value.substring(0,b)+a.value.substring(b+c.tabString.length);a.focus();a.setSelectionRange(b,b)}}else{a.value=a.value.substring(0,b)+c.tabString+a.value.substring(b);a.focus();a.setSelectionRange(b+c.tabString.length,b+c.tabString.length)}else{var m=a.value.split("\n"),j=new Array(),g=0,d=0,p=false;for(var i in m){d=g+m[i].length;j.push({start:g,end:d,selected:g<=b&&d>b||d>=h&&g<h||g>b&&d<h});g=d+1}var e=0;for(var i in j)if(j[i].selected){var f=j[i].start+e;if(l&&c.tabString==a.value.substring(f,f+c.tabString.length)){a.value=a.value.substring(0,f)+a.value.substring(f+c.tabString.length);e-=c.tabString.length}else if(!l){a.value=a.value.substring(0,f)+c.tabString+a.value.substring(f);e+=c.tabString.length}}a.focus();var o=b+(e>0?c.tabString.length:e<0?-c.tabString.length:0),n=h+e;a.setSelectionRange(o,n)}}function x(i,e,a){var b=document.selection.createRange();if(i==b.parentElement())if(""==b.text)if(e){var s=b.getBookmark();b.moveStart("character",-a.tabString.length);if(a.tabString==b.text)b.text="";else{b.moveToBookmark(s);b.moveEnd("character",a.tabString.length);if(a.tabString==b.text)b.text=""}b.collapse(true);b.select()}else{b.text=a.tabString;b.collapse(false);b.select()}else{var r=b.text,o=r.length,c=r.split("\r\n"),f=document.body.createTextRange();f.moveToElementText(i);f.setEndPoint("EndToStart",b);var q=f.text,d=q.split("\r\n"),h=q.length,l=document.body.createTextRange();l.moveToElementText(i);l.setEndPoint("StartToEnd",b);var p=l.text,n=document.body.createTextRange();n.moveToElementText(i);n.setEndPoint("StartToEnd",f);var t=n.text,m=k(i).html();k("#r3").text(h+" + "+o+" + "+p.length+" = "+m.length);if(h+t.length<m.length){d.push("");h+=2;if(e&&a.tabString==c[0].substring(0,a.tabString.length))c[0]=c[0].substring(a.tabString.length);else if(!e)c[0]=a.tabString+c[0]}else if(e&&a.tabString==d[d.length-1].substring(0,a.tabString.length))d[d.length-1]=d[d.length-1].substring(a.tabString.length);else if(!e)d[d.length-1]=a.tabString+d[d.length-1];for(var g=1;g<c.length;g++)if(e&&a.tabString==c[g].substring(0,a.tabString.length))c[g]=c[g].substring(a.tabString.length);else if(!e)c[g]=a.tabString+c[g];if(1==d.length&&0==h)if(e&&a.tabString==c[0].substring(0,a.tabString.length))c[0]=c[0].substring(a.tabString.length);else if(!e)c[0]=a.tabString+c[0];if(h+o+p.length<m.length){c.push("");o+=2}f.text=d.join("\r\n");b.text=c.join("\r\n");var j=document.body.createTextRange();j.moveToElementText(i);if(0<h)j.setEndPoint("StartToEnd",f);else j.setEndPoint("StartToStart",f);j.setEndPoint("EndToEnd",b);j.select()}}})(jQuery)